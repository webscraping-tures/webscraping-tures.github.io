<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Transformation with dplyr | Web Scraping using R</title>
  <meta name="description" content="11 Transformation with dplyr | Web Scraping using R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Transformation with dplyr | Web Scraping using R" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="webscraping-tures/webscraping-tures.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Transformation with dplyr | Web Scraping using R" />
  
  
  

<meta name="author" content="Jakob Tures" />


<meta name="date" content="2021-06-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="scraping.html"/>
<link rel="next" href="ggplot.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/echarts4r-4.8.0/echarts-en.min.js"></script>
<script src="libs/echarts4r-4.8.0/ecStat.min.js"></script>
<script src="libs/echarts4r-4.8.0/dataTool.min.js"></script>
<script src="libs/echarts4r-binding-0.4.0/echarts4r.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
Web Scraping using R

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-web-scraping"><i class="fa fa-check"></i>What is web scraping?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#technical-requirements"><i class="fa fa-check"></i>Technical requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="1" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>1</b> HTML as a cornerstone of the internet</a>
<ul>
<li class="chapter" data-level="1.1" data-path="html.html"><a href="html.html#html-tags"><i class="fa fa-check"></i><b>1.1</b> HTML-Tags</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="html.html"><a href="html.html#hello_world.html"><i class="fa fa-check"></i><b>1.1.1</b> hello_world.html</a></li>
<li class="chapter" data-level="1.1.2" data-path="html.html"><a href="html.html#important-tags"><i class="fa fa-check"></i><b>1.1.2</b> Important tags</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="html.html"><a href="html.html#attribute"><i class="fa fa-check"></i><b>1.2</b> Attributes</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="html.html"><a href="html.html#links"><i class="fa fa-check"></i><b>1.2.1</b> Links</a></li>
<li class="chapter" data-level="1.2.2" data-path="html.html"><a href="html.html#images"><i class="fa fa-check"></i><b>1.2.2</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="html.html"><a href="html.html#entities"><i class="fa fa-check"></i><b>1.3</b> Entities</a></li>
</ul></li>
<li class="part"><span><b>II R Basics &amp; Tidyverse</b></span></li>
<li class="chapter" data-level="2" data-path="R1.html"><a href="R1.html"><i class="fa fa-check"></i><b>2</b> R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="R1.html"><a href="R1.html#installing-r"><i class="fa fa-check"></i><b>2.1</b> Installing R</a></li>
<li class="chapter" data-level="2.2" data-path="R1.html"><a href="R1.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="R1.html"><a href="R1.html#overview"><i class="fa fa-check"></i><b>2.2.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="R1.html"><a href="R1.html#hello-world"><i class="fa fa-check"></i><b>2.3</b> Hello World!</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="R1.html"><a href="R1.html#calculating-with-r"><i class="fa fa-check"></i><b>2.3.1</b> Calculating with R</a></li>
<li class="chapter" data-level="2.3.2" data-path="R1.html"><a href="R1.html#comparison"><i class="fa fa-check"></i><b>2.3.2</b> Comparison operators</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="R1.html"><a href="R1.html#objects"><i class="fa fa-check"></i><b>2.4</b> Objects</a></li>
<li class="chapter" data-level="2.5" data-path="R1.html"><a href="R1.html#vectors"><i class="fa fa-check"></i><b>2.5</b> Vectors</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="R1.html"><a href="R1.html#subsetting"><i class="fa fa-check"></i><b>2.5.1</b> Subsetting</a></li>
<li class="chapter" data-level="2.5.2" data-path="R1.html"><a href="R1.html#types-of-vectors"><i class="fa fa-check"></i><b>2.5.2</b> Types of vectors</a></li>
<li class="chapter" data-level="2.5.3" data-path="R1.html"><a href="R1.html#a-brief-look-at-lists"><i class="fa fa-check"></i><b>2.5.3</b> A brief look at lists</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="R1.html"><a href="R1.html#functions"><i class="fa fa-check"></i><b>2.6</b> Functions</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="R1.html"><a href="R1.html#help"><i class="fa fa-check"></i><b>2.6.1</b> Help</a></li>
<li class="chapter" data-level="2.6.2" data-path="R1.html"><a href="R1.html#examples-basic-statistical-functions"><i class="fa fa-check"></i><b>2.6.2</b> Examples: Basic statistical functions</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="R1.html"><a href="R1.html#ifelse-statements"><i class="fa fa-check"></i><b>2.7</b> If/Else statements</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="R2.html"><a href="R2.html"><i class="fa fa-check"></i><b>3</b> RStudio in practice &amp; the tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="R2.html"><a href="R2.html#rstudio-workflow"><i class="fa fa-check"></i><b>3.1</b> RStudio Workflow</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="R2.html"><a href="R2.html#r-scripts"><i class="fa fa-check"></i><b>3.1.1</b> R Scripts</a></li>
<li class="chapter" data-level="3.1.2" data-path="R2.html"><a href="R2.html#projects"><i class="fa fa-check"></i><b>3.1.2</b> Projects</a></li>
<li class="chapter" data-level="3.1.3" data-path="R2.html"><a href="R2.html#comments"><i class="fa fa-check"></i><b>3.1.3</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="R2.html"><a href="R2.html#r-packages"><i class="fa fa-check"></i><b>3.2</b> R packages</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="R2.html"><a href="R2.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>3.2.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="3.2.2" data-path="R2.html"><a href="R2.html#namespaces"><i class="fa fa-check"></i><b>3.2.2</b> Namespaces</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="R2.html"><a href="R2.html#tidyverse"><i class="fa fa-check"></i><b>3.3</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="R2.html"><a href="R2.html#tibbles"><i class="fa fa-check"></i><b>3.3.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="R2.html"><a href="R2.html#additional-resources"><i class="fa fa-check"></i><b>3.4</b> Additional resources</a></li>
</ul></li>
<li class="part"><span><b>III Scraping</b></span></li>
<li class="chapter" data-level="4" data-path="rvest1.html"><a href="rvest1.html"><i class="fa fa-check"></i><b>4</b> First scraping with rvest</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rvest1.html"><a href="rvest1.html#the-rvest-package"><i class="fa fa-check"></i><b>4.1</b> The rvest package</a></li>
<li class="chapter" data-level="4.2" data-path="rvest1.html"><a href="rvest1.html#hello_world.html-1"><i class="fa fa-check"></i><b>4.2</b> hello_world.html</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rvest1.html"><a href="rvest1.html#read_html"><i class="fa fa-check"></i><b>4.2.1</b> read_html()</a></li>
<li class="chapter" data-level="4.2.2" data-path="rvest1.html"><a href="rvest1.html#html_nodes"><i class="fa fa-check"></i><b>4.2.2</b> html_nodes()</a></li>
<li class="chapter" data-level="4.2.3" data-path="rvest1.html"><a href="rvest1.html#html_text"><i class="fa fa-check"></i><b>4.2.3</b> html_text()</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rvest1.html"><a href="rvest1.html#countries-of-the-world"><i class="fa fa-check"></i><b>4.3</b> Countries of the World</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rvest1.html"><a href="rvest1.html#country-names"><i class="fa fa-check"></i><b>4.3.1</b> Country names</a></li>
<li class="chapter" data-level="4.3.2" data-path="rvest1.html"><a href="rvest1.html#capitals-population-and-area"><i class="fa fa-check"></i><b>4.3.2</b> Capitals, population and area</a></li>
<li class="chapter" data-level="4.3.3" data-path="rvest1.html"><a href="rvest1.html#merge-into-one-tibble"><i class="fa fa-check"></i><b>4.3.3</b> Merge into one tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html"><i class="fa fa-check"></i><b>5</b> CSS selectors &amp; Developer Tools</a>
<ul>
<li class="chapter" data-level="5.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#css"><i class="fa fa-check"></i><b>5.1</b> CSS selectors</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#classes"><i class="fa fa-check"></i><b>5.1.1</b> Classes</a></li>
<li class="chapter" data-level="5.1.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#ids"><i class="fa fa-check"></i><b>5.1.2</b> IDs</a></li>
<li class="chapter" data-level="5.1.3" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#attributes"><i class="fa fa-check"></i><b>5.1.3</b> Attributes</a></li>
<li class="chapter" data-level="5.1.4" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#hierarchy-levels"><i class="fa fa-check"></i><b>5.1.4</b> Hierarchy levels</a></li>
<li class="chapter" data-level="5.1.5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#further-selectors"><i class="fa fa-check"></i><b>5.1.5</b> Further selectors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#developer-tools"><i class="fa fa-check"></i><b>5.2</b> Developer Tools</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rvest2.html"><a href="rvest2.html"><i class="fa fa-check"></i><b>6</b> Scraping of tables &amp; dynamic websites</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rvest2.html"><a href="rvest2.html#scraping-of-tables"><i class="fa fa-check"></i><b>6.1</b> Scraping of tables</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rvest2.html"><a href="rvest2.html#table-with-css-selectors-from-wikipedia"><i class="fa fa-check"></i><b>6.1.1</b> Table with CSS selectors from Wikipedia</a></li>
<li class="chapter" data-level="6.1.2" data-path="rvest2.html"><a href="rvest2.html#scraping-multiple-tables"><i class="fa fa-check"></i><b>6.1.2</b> Scraping multiple tables</a></li>
<li class="chapter" data-level="6.1.3" data-path="rvest2.html"><a href="rvest2.html#tabellen-mit-nas"><i class="fa fa-check"></i><b>6.1.3</b> Tabellen mit NAs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rvest2.html"><a href="rvest2.html#dynamische-websites"><i class="fa fa-check"></i><b>6.2</b> Dynamische Websites</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rvest2.html"><a href="rvest2.html#html-forms-and-html-queries"><i class="fa fa-check"></i><b>6.2.1</b> HTML forms and HTML queries</a></li>
<li class="chapter" data-level="6.2.2" data-path="rvest2.html"><a href="rvest2.html#html-forms"><i class="fa fa-check"></i><b>6.2.2</b> HTML forms</a></li>
<li class="chapter" data-level="6.2.3" data-path="rvest2.html"><a href="rvest2.html#the-query"><i class="fa fa-check"></i><b>6.2.3</b> The query</a></li>
<li class="chapter" data-level="6.2.4" data-path="rvest2.html"><a href="rvest2.html#manipulating-the-query-and-scraping-the-result"><i class="fa fa-check"></i><b>6.2.4</b> Manipulating the query and scraping the result</a></li>
<li class="chapter" data-level="6.2.5" data-path="rvest2.html"><a href="rvest2.html#additional-resources-1"><i class="fa fa-check"></i><b>6.2.5</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rvest3.html"><a href="rvest3.html"><i class="fa fa-check"></i><b>7</b> Scraping of multi-page websites</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rvest3.html"><a href="rvest3.html#index-pages"><i class="fa fa-check"></i><b>7.1</b> Index-pages</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rvest3.html"><a href="rvest3.html#scraping-of-the-index"><i class="fa fa-check"></i><b>7.1.1</b> Scraping of the index</a></li>
<li class="chapter" data-level="7.1.2" data-path="rvest3.html"><a href="rvest3.html#iteration-with-map"><i class="fa fa-check"></i><b>7.1.2</b> Iteration with map()</a></li>
<li class="chapter" data-level="7.1.3" data-path="rvest3.html"><a href="rvest3.html#scraping-the-sub-pages"><i class="fa fa-check"></i><b>7.1.3</b> Scraping the sub-pages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rvest3.html"><a href="rvest3.html#pagination"><i class="fa fa-check"></i><b>7.2</b> Pagination</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rvest3.html"><a href="rvest3.html#the-query-1"><i class="fa fa-check"></i><b>7.2.1</b> The query</a></li>
<li class="chapter" data-level="7.2.2" data-path="rvest3.html"><a href="rvest3.html#sub-pgs"><i class="fa fa-check"></i><b>7.2.2</b> Scraping the sub-pages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>8</b> Downloading and saving files</a>
<ul>
<li class="chapter" data-level="8.1" data-path="files.html"><a href="files.html#csv-files"><i class="fa fa-check"></i><b>8.1</b> CSV files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="files.html"><a href="files.html#parsing-a-csv-file"><i class="fa fa-check"></i><b>8.1.1</b> Parsing a CSV file</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="files.html"><a href="files.html#downloading-files"><i class="fa fa-check"></i><b>8.2</b> Downloading files</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="files.html"><a href="files.html#parsing-the-csv-files"><i class="fa fa-check"></i><b>8.2.1</b> Parsing the csv files</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="files.html"><a href="files.html#saving-data-files"><i class="fa fa-check"></i><b>8.3</b> Saving data files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="goodpractice.html"><a href="goodpractice.html"><i class="fa fa-check"></i><b>9</b> Good practice</a>
<ul>
<li class="chapter" data-level="9.1" data-path="goodpractice.html"><a href="goodpractice.html#we-aint-no-web-crawlers"><i class="fa fa-check"></i><b>9.1</b> We ain’t no web crawlers</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="goodpractice.html"><a href="goodpractice.html#on-robots.txt-files"><i class="fa fa-check"></i><b>9.1.1</b> On robots.txt files</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="goodpractice.html"><a href="goodpractice.html#reduce-traffic"><i class="fa fa-check"></i><b>9.2</b> Reduce traffic</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="goodpractice.html"><a href="goodpractice.html#waiting-times-in-action"><i class="fa fa-check"></i><b>9.2.1</b> Waiting times in action</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="goodpractice.html"><a href="goodpractice.html#citation-and-an-additional-resource"><i class="fa fa-check"></i><b>9.3</b> Citation and an additional resource</a></li>
</ul></li>
<li class="part"><span><b>IV Data analysis</b></span></li>
<li class="chapter" data-level="10" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>10</b> Running example</a>
<ul>
<li class="chapter" data-level="10.1" data-path="scraping.html"><a href="scraping.html#gathering-the-links"><i class="fa fa-check"></i><b>10.1</b> Gathering the links</a></li>
<li class="chapter" data-level="10.2" data-path="scraping.html"><a href="scraping.html#downloading-the-subpages"><i class="fa fa-check"></i><b>10.2</b> Downloading the subpages</a></li>
<li class="chapter" data-level="10.3" data-path="scraping.html"><a href="scraping.html#extracting-the-data-of-interest"><i class="fa fa-check"></i><b>10.3</b> Extracting the data of interest</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="scraping.html"><a href="scraping.html#dealing-with-missing-data-in-lists"><i class="fa fa-check"></i><b>10.3.1</b> Dealing with missing data in lists</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="scraping.html"><a href="scraping.html#saving-the-data"><i class="fa fa-check"></i><b>10.4</b> Saving the data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>11</b> Transformation with dplyr</a>
<ul>
<li class="chapter" data-level="11.1" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>11.1</b> <code>mutate()</code></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="dplyr.html"><a href="dplyr.html#computing-new-variables-from-existing-ones"><i class="fa fa-check"></i><b>11.1.1</b> Computing new variables from existing ones</a></li>
<li class="chapter" data-level="11.1.2" data-path="dplyr.html"><a href="dplyr.html#cleaning-the-data-on-police-reports"><i class="fa fa-check"></i><b>11.1.2</b> Cleaning the data on police reports</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>11.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="11.3" data-path="dplyr.html"><a href="dplyr.html#rename"><i class="fa fa-check"></i><b>11.3</b> <code>rename()</code></a></li>
<li class="chapter" data-level="11.4" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>11.4</b> <code>filter()</code></a></li>
<li class="chapter" data-level="11.5" data-path="dplyr.html"><a href="dplyr.html#summarise-group_by"><i class="fa fa-check"></i><b>11.5</b> <code>summarise()</code> &amp; <code>group_by()</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="dplyr.html"><a href="dplyr.html#number-of-reports-by-groups"><i class="fa fa-check"></i><b>11.5.1</b> Number of reports by groups</a></li>
<li class="chapter" data-level="11.5.2" data-path="dplyr.html"><a href="dplyr.html#summary-statistics-on-the-time"><i class="fa fa-check"></i><b>11.5.2</b> Summary statistics on the time</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>12</b> Graphical analysis with ggplot</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ggplot.html"><a href="ggplot.html#ggplot-syntax"><i class="fa fa-check"></i><b>12.1</b> ggplot syntax</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot.html"><a href="ggplot.html#aesthetics"><i class="fa fa-check"></i><b>12.2</b> Aesthetics</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ggplot.html"><a href="ggplot.html#continuous"><i class="fa fa-check"></i><b>12.2.1</b> Continuous</a></li>
<li class="chapter" data-level="12.2.2" data-path="ggplot.html"><a href="ggplot.html#continuous-x-continuous"><i class="fa fa-check"></i><b>12.2.2</b> Continuous x Continuous</a></li>
<li class="chapter" data-level="12.2.3" data-path="ggplot.html"><a href="ggplot.html#discrete-x-continuous"><i class="fa fa-check"></i><b>12.2.3</b> Discrete x Continuous</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ggplot.html"><a href="ggplot.html#tuning-the-output"><i class="fa fa-check"></i><b>12.3</b> Tuning the output</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>13</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="13.1" data-path="regex.html"><a href="regex.html#str_detect"><i class="fa fa-check"></i><b>13.1</b> str_detect()</a></li>
<li class="chapter" data-level="13.2" data-path="regex.html"><a href="regex.html#basic-pattern-matching"><i class="fa fa-check"></i><b>13.2</b> Basic pattern matching</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="regex.html"><a href="regex.html#literal-characters"><i class="fa fa-check"></i><b>13.2.1</b> Literal characters</a></li>
<li class="chapter" data-level="13.2.2" data-path="regex.html"><a href="regex.html#escaping-metacharacters"><i class="fa fa-check"></i><b>13.2.2</b> Escaping metacharacters</a></li>
<li class="chapter" data-level="13.2.3" data-path="regex.html"><a href="regex.html#character-classes"><i class="fa fa-check"></i><b>13.2.3</b> Character classes</a></li>
<li class="chapter" data-level="13.2.4" data-path="regex.html"><a href="regex.html#anchors"><i class="fa fa-check"></i><b>13.2.4</b> Anchors</a></li>
<li class="chapter" data-level="13.2.5" data-path="regex.html"><a href="regex.html#quantifiers"><i class="fa fa-check"></i><b>13.2.5</b> Quantifiers</a></li>
<li class="chapter" data-level="13.2.6" data-path="regex.html"><a href="regex.html#groups"><i class="fa fa-check"></i><b>13.2.6</b> Groups</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="regex.html"><a href="regex.html#practical-application"><i class="fa fa-check"></i><b>13.3</b> Practical application</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="regex.html"><a href="regex.html#str_count"><i class="fa fa-check"></i><b>13.3.1</b> str_count()</a></li>
<li class="chapter" data-level="13.3.2" data-path="regex.html"><a href="regex.html#str_extract-str_match"><i class="fa fa-check"></i><b>13.3.2</b> str_extract() &amp; str_match()</a></li>
<li class="chapter" data-level="13.3.3" data-path="regex.html"><a href="regex.html#str_replace"><i class="fa fa-check"></i><b>13.3.3</b> str_replace()</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Transformation with dplyr</h1>
<p>In this chapter, we will use several functions from the tidyverse package
dplyr to clean the data we scraped in chapter <a href="scraping.html#scraping">10</a>. We will then
select the columns and filter the observations (rows) we need, as well as
compute some grouped summaries of the data.</p>
<p>First, let us load the required packages. Dplyr is part of the core tidyverse;
we will need the package lubridate as well, to be able to deal with dates and
times.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="dplyr.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb188-2"><a href="dplyr.html#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<div id="mutate" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> <code>mutate()</code></h2>
<div id="computing-new-variables-from-existing-ones" class="section level3" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Computing new variables from existing ones</h3>
<p>Before we continue working on our current example, we will look at some simple
examples that will show how new variables can be computed in a tibble from
existing ones, using <code>mutate()</code> from dplyr.</p>
<p>For this purpose, let us create a new simple tibble on voter turnout. Note that
the entered data is purely illustrational and has no meaning.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="dplyr.html#cb189-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb189-2"><a href="dplyr.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ybirth =</span> <span class="fu">c</span>(<span class="st">&quot;1993 - 2002&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>, <span class="st">&quot;1973 - 1982&quot;</span>, <span class="st">&quot;1963 - 1972&quot;</span>),</span>
<span id="cb189-3"><a href="dplyr.html#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">eligible =</span> <span class="fu">c</span>(<span class="dv">100000</span>, <span class="dv">100000</span>, <span class="dv">100000</span>, <span class="dv">100000</span>),</span>
<span id="cb189-4"><a href="dplyr.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">turnout_person =</span> <span class="fu">c</span>(<span class="dv">40000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>, <span class="dv">70000</span>),</span>
<span id="cb189-5"><a href="dplyr.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">turnout_mail =</span> <span class="fu">c</span> (<span class="dv">35000</span>, <span class="dv">30000</span>, <span class="dv">25000</span>, <span class="dv">20000</span>)</span>
<span id="cb189-6"><a href="dplyr.html#cb189-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-7"><a href="dplyr.html#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="dplyr.html#cb189-8" aria-hidden="true" tabindex="-1"></a>exmpl_tbl</span>
<span id="cb189-9"><a href="dplyr.html#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 4</span></span>
<span id="cb189-10"><a href="dplyr.html#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   ybirth      eligible turnout_person turnout_mail</span></span>
<span id="cb189-11"><a href="dplyr.html#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb189-12"><a href="dplyr.html#cb189-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 1993 - 2002   100000          40000        35000</span></span>
<span id="cb189-13"><a href="dplyr.html#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 1983 - 1992   100000          50000        30000</span></span>
<span id="cb189-14"><a href="dplyr.html#cb189-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 1973 - 1982   100000          60000        25000</span></span>
<span id="cb189-15"><a href="dplyr.html#cb189-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 1963 - 1972   100000          70000        20000</span></span></code></pre></div>
<p>Here we have different columns for people who voted in person and who voted by
mail, by their year of birth. We do not actually care about the difference in
the voting method in this example and want one column that combines both. We can
get there by using <code>mutate()</code>. The function takes the data to be manipulated as
its first argument, followed by one or multiple arguments defining the new
columns to be created. We can create this new columns as computations from the
columns already present.</p>
<p>To calculate the total turnout, we write:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="dplyr.html#cb190-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb190-2"><a href="dplyr.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">turnout =</span> turnout_person <span class="sc">+</span> turnout_mail)</span>
<span id="cb190-3"><a href="dplyr.html#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 5</span></span>
<span id="cb190-4"><a href="dplyr.html#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   ybirth      eligible turnout_person turnout_mail turnout</span></span>
<span id="cb190-5"><a href="dplyr.html#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb190-6"><a href="dplyr.html#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 1993 - 2002   100000          40000        35000   75000</span></span>
<span id="cb190-7"><a href="dplyr.html#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 1983 - 1992   100000          50000        30000   80000</span></span>
<span id="cb190-8"><a href="dplyr.html#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 1973 - 1982   100000          60000        25000   85000</span></span>
<span id="cb190-9"><a href="dplyr.html#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 1963 - 1972   100000          70000        20000   90000</span></span></code></pre></div>
<p>We can also immediately start calculating with new columns in the same pipe. To
calculate the turnout percentage in a second step, we write the following:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="dplyr.html#cb191-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb191-2"><a href="dplyr.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb191-3"><a href="dplyr.html#cb191-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout =</span> turnout_person <span class="sc">+</span> turnout_mail,</span>
<span id="cb191-4"><a href="dplyr.html#cb191-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_pct =</span> turnout <span class="sc">/</span> eligible</span>
<span id="cb191-5"><a href="dplyr.html#cb191-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb191-6"><a href="dplyr.html#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 6</span></span>
<span id="cb191-7"><a href="dplyr.html#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   ybirth      eligible turnout_person turnout_mail turnout turnout_pct</span></span>
<span id="cb191-8"><a href="dplyr.html#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb191-9"><a href="dplyr.html#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 1993 - 2002   100000          40000        35000   75000        0.75</span></span>
<span id="cb191-10"><a href="dplyr.html#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 1983 - 1992   100000          50000        30000   80000        0.8 </span></span>
<span id="cb191-11"><a href="dplyr.html#cb191-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 1973 - 1982   100000          60000        25000   85000        0.85</span></span>
<span id="cb191-12"><a href="dplyr.html#cb191-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 1963 - 1972   100000          70000        20000   90000        0.9</span></span></code></pre></div>
<p>Note that <code>mutate()</code> is not limited to basic arithmetic operations. Many
functions can be applied within <code>mutate()</code>: <code>sum()</code> or <code>mean()</code> are two examples
we already know.</p>
</div>
<div id="cleaning-the-data-on-police-reports" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Cleaning the data on police reports</h3>
<p>Now knowing the basic principle of working with <code>mutate()</code>, we can apply this to
the data on police reports we scraped in chapter <a href="scraping.html#scraping">10</a>.</p>
<p>First we have to load the data and examine what we are working with.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="dplyr.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;reports.RData&quot;</span>)</span>
<span id="cb192-2"><a href="dplyr.html#cb192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-3"><a href="dplyr.html#cb192-3" aria-hidden="true" tabindex="-1"></a>reports</span>
<span id="cb192-4"><a href="dplyr.html#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 3</span></span>
<span id="cb192-5"><a href="dplyr.html#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    Date          Report                                   District              </span></span>
<span id="cb192-6"><a href="dplyr.html#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;         &lt;chr&gt;                                    &lt;chr&gt;                 </span></span>
<span id="cb192-7"><a href="dplyr.html#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21.06.2021 1… &quot;Nach Hausfriedensbruch Widerstand gele… Ereignisort: Marzahn-…</span></span>
<span id="cb192-8"><a href="dplyr.html#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21.06.2021 1… &quot;Marzena MÄRZ vermisst – Polizei Berlin… Ereignisort: Reinicke…</span></span>
<span id="cb192-9"><a href="dplyr.html#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21.06.2021 1… &quot;Mehrere Verletzte nach Schüssen vor ei… Ereignisort: Mitte    </span></span>
<span id="cb192-10"><a href="dplyr.html#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21.06.2021 1… &quot;Streit eskalierte&quot;                      Ereignisort: Lichtenb…</span></span>
<span id="cb192-11"><a href="dplyr.html#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21.06.2021 1… &quot;Fünf Verletzte bei Unfall &quot;             Ereignisort: Tempelho…</span></span>
<span id="cb192-12"><a href="dplyr.html#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21.06.2021 1… &quot;Zivilstreife stoppt Raser&quot;              Ereignisort: Charlott…</span></span>
<span id="cb192-13"><a href="dplyr.html#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21.06.2021 0… &quot;In Jugendeinrichtung randaliert und Po… Ereignisort: Spandau  </span></span>
<span id="cb192-14"><a href="dplyr.html#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20.06.2021 1… &quot;Mehrere Verletzte nach Messerangriff&quot;   Ereignisort: Friedric…</span></span>
<span id="cb192-15"><a href="dplyr.html#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20.06.2021 1… &quot;Gemeinsame Meldung mit der Staatsanwal… Ereignisort: Mitte    </span></span>
<span id="cb192-16"><a href="dplyr.html#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20.06.2021 1… &quot;Senior mit Fahrrad gestürzt und schwer… Ereignisort: Spandau  </span></span>
<span id="cb192-17"><a href="dplyr.html#cb192-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
<p>We can leave the column containing the text of the police report as it is, but
the columns containing the districts, as well as the date and time, could use
some work.</p>
<p>The data in the column “District” includes the string “Ereignisort:” before
listing the actual name of the district the report refers to. This unnecessarily
clutters this column: we can use <code>substr()</code> to remove these leading characters.
Instead of selecting the column by <code>reports$District</code>, we can apply the function
to the column using <code>mutate()</code>. <code>substr()</code> extracts a part of a string we want
to keep, taking the data to be applied to, as its first argument – here the
name of the column –, the starting character position where the extraction
shall begin as its second, and the character position where it shall stop, as
its third argument. Character position here refers to the numeric position of a
character in a string: to begin extraction after “Ereignisort:” we have to
count the length of this substring including the whitespace after “:”, which is
<span class="math inline">\(13\)</span> and thus use <span class="math inline">\(14\)</span> as the starting position. For the position to stop
extraction, we could either use an unrealistically high number or use
<code>length(District)</code> to determine the exact length of each string.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="dplyr.html#cb193-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb193-2"><a href="dplyr.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">substr</span>(District, <span class="dv">14</span>, <span class="dv">99</span>))</span>
<span id="cb193-3"><a href="dplyr.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 3</span></span>
<span id="cb193-4"><a href="dplyr.html#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Date           Report                                       District         </span></span>
<span id="cb193-5"><a href="dplyr.html#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;          &lt;chr&gt;                                        &lt;chr&gt;            </span></span>
<span id="cb193-6"><a href="dplyr.html#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21.06.2021 15… &quot;Nach Hausfriedensbruch Widerstand geleiste… Marzahn-Hellersd…</span></span>
<span id="cb193-7"><a href="dplyr.html#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21.06.2021 13… &quot;Marzena MÄRZ vermisst – Polizei Berlin bit… Reinickendorf    </span></span>
<span id="cb193-8"><a href="dplyr.html#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21.06.2021 13… &quot;Mehrere Verletzte nach Schüssen vor einem … Mitte            </span></span>
<span id="cb193-9"><a href="dplyr.html#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21.06.2021 13… &quot;Streit eskalierte&quot;                          Lichtenberg      </span></span>
<span id="cb193-10"><a href="dplyr.html#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21.06.2021 10… &quot;Fünf Verletzte bei Unfall &quot;                 Tempelhof-Schöne…</span></span>
<span id="cb193-11"><a href="dplyr.html#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21.06.2021 10… &quot;Zivilstreife stoppt Raser&quot;                  Charlottenburg-W…</span></span>
<span id="cb193-12"><a href="dplyr.html#cb193-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21.06.2021 09… &quot;In Jugendeinrichtung randaliert und Polizi… Spandau          </span></span>
<span id="cb193-13"><a href="dplyr.html#cb193-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20.06.2021 13… &quot;Mehrere Verletzte nach Messerangriff&quot;       Friedrichshain-K…</span></span>
<span id="cb193-14"><a href="dplyr.html#cb193-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20.06.2021 12… &quot;Gemeinsame Meldung mit der Staatsanwaltsch… Mitte            </span></span>
<span id="cb193-15"><a href="dplyr.html#cb193-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20.06.2021 11… &quot;Senior mit Fahrrad gestürzt und schwer ver… Spandau          </span></span>
<span id="cb193-16"><a href="dplyr.html#cb193-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span>
<span id="cb193-17"><a href="dplyr.html#cb193-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-18"><a href="dplyr.html#cb193-18" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb193-19"><a href="dplyr.html#cb193-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">substr</span>(District, <span class="dv">14</span>, <span class="fu">length</span>(District)))</span>
<span id="cb193-20"><a href="dplyr.html#cb193-20" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 3</span></span>
<span id="cb193-21"><a href="dplyr.html#cb193-21" aria-hidden="true" tabindex="-1"></a><span class="do">##    Date           Report                                       District         </span></span>
<span id="cb193-22"><a href="dplyr.html#cb193-22" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;          &lt;chr&gt;                                        &lt;chr&gt;            </span></span>
<span id="cb193-23"><a href="dplyr.html#cb193-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21.06.2021 15… &quot;Nach Hausfriedensbruch Widerstand geleiste… Marzahn-Hellersd…</span></span>
<span id="cb193-24"><a href="dplyr.html#cb193-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21.06.2021 13… &quot;Marzena MÄRZ vermisst – Polizei Berlin bit… Reinickendorf    </span></span>
<span id="cb193-25"><a href="dplyr.html#cb193-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21.06.2021 13… &quot;Mehrere Verletzte nach Schüssen vor einem … Mitte            </span></span>
<span id="cb193-26"><a href="dplyr.html#cb193-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21.06.2021 13… &quot;Streit eskalierte&quot;                          Lichtenberg      </span></span>
<span id="cb193-27"><a href="dplyr.html#cb193-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21.06.2021 10… &quot;Fünf Verletzte bei Unfall &quot;                 Tempelhof-Schöne…</span></span>
<span id="cb193-28"><a href="dplyr.html#cb193-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21.06.2021 10… &quot;Zivilstreife stoppt Raser&quot;                  Charlottenburg-W…</span></span>
<span id="cb193-29"><a href="dplyr.html#cb193-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21.06.2021 09… &quot;In Jugendeinrichtung randaliert und Polizi… Spandau          </span></span>
<span id="cb193-30"><a href="dplyr.html#cb193-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20.06.2021 13… &quot;Mehrere Verletzte nach Messerangriff&quot;       Friedrichshain-K…</span></span>
<span id="cb193-31"><a href="dplyr.html#cb193-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20.06.2021 12… &quot;Gemeinsame Meldung mit der Staatsanwaltsch… Mitte            </span></span>
<span id="cb193-32"><a href="dplyr.html#cb193-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20.06.2021 11… &quot;Senior mit Fahrrad gestürzt und schwer ver… Spandau          </span></span>
<span id="cb193-33"><a href="dplyr.html#cb193-33" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
<p>The column “Date” includes the data and the time of each report as a character
string. To be able to use this data in analysis, we have to extract the date and
time in a format R can understand. This is easily achieved using the parsing
functions from lubridate. As the character data are written in the format
“day.month.year hour:minute”, we have to use the function <code>dmy_hm()</code> on the
column.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="dplyr.html#cb194-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb194-2"><a href="dplyr.html#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_cmpl =</span> <span class="fu">dmy_hm</span>(Date))</span>
<span id="cb194-3"><a href="dplyr.html#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 4</span></span>
<span id="cb194-4"><a href="dplyr.html#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Date       Report                       District          date_cmpl          </span></span>
<span id="cb194-5"><a href="dplyr.html#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;      &lt;chr&gt;                        &lt;chr&gt;             &lt;dttm&gt;             </span></span>
<span id="cb194-6"><a href="dplyr.html#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21.06.202… &quot;Nach Hausfriedensbruch Wid… Ereignisort: Mar… 2021-06-21 15:17:00</span></span>
<span id="cb194-7"><a href="dplyr.html#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21.06.202… &quot;Marzena MÄRZ vermisst – Po… Ereignisort: Rei… 2021-06-21 13:35:00</span></span>
<span id="cb194-8"><a href="dplyr.html#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21.06.202… &quot;Mehrere Verletzte nach Sch… Ereignisort: Mit… 2021-06-21 13:19:00</span></span>
<span id="cb194-9"><a href="dplyr.html#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21.06.202… &quot;Streit eskalierte&quot;          Ereignisort: Lic… 2021-06-21 13:17:00</span></span>
<span id="cb194-10"><a href="dplyr.html#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21.06.202… &quot;Fünf Verletzte bei Unfall &quot; Ereignisort: Tem… 2021-06-21 10:41:00</span></span>
<span id="cb194-11"><a href="dplyr.html#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21.06.202… &quot;Zivilstreife stoppt Raser&quot;  Ereignisort: Cha… 2021-06-21 10:30:00</span></span>
<span id="cb194-12"><a href="dplyr.html#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21.06.202… &quot;In Jugendeinrichtung randa… Ereignisort: Spa… 2021-06-21 09:55:00</span></span>
<span id="cb194-13"><a href="dplyr.html#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20.06.202… &quot;Mehrere Verletzte nach Mes… Ereignisort: Fri… 2021-06-20 13:30:00</span></span>
<span id="cb194-14"><a href="dplyr.html#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20.06.202… &quot;Gemeinsame Meldung mit der… Ereignisort: Mit… 2021-06-20 12:12:00</span></span>
<span id="cb194-15"><a href="dplyr.html#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20.06.202… &quot;Senior mit Fahrrad gestürz… Ereignisort: Spa… 2021-06-20 11:21:00</span></span>
<span id="cb194-16"><a href="dplyr.html#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
<p>At a later point we will do some analysis by year, month, weekday and time of
day. Lubridate includes functions that extract the subparts of date and time
data.</p>
<p><code>year()</code> extracts the year, <code>month()</code> the month and <code>wday()</code> the day of the
week. The argument <code>label = TRUE</code> tells the function to use the names of months
and days instead of a numerical value ranging from <span class="math inline">\(1\)</span> to <span class="math inline">\(12\)</span> and <span class="math inline">\(1\)</span> to <span class="math inline">\(7\)</span>
respectively.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="dplyr.html#cb195-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb195-2"><a href="dplyr.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_cmpl =</span> <span class="fu">dmy_hm</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb195-3"><a href="dplyr.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date_cmpl)) <span class="sc">%&gt;%</span> </span>
<span id="cb195-4"><a href="dplyr.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb195-5"><a href="dplyr.html#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day =</span> <span class="fu">wday</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>))</span>
<span id="cb195-6"><a href="dplyr.html#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 7</span></span>
<span id="cb195-7"><a href="dplyr.html#cb195-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    Date     Report            District     date_cmpl            year month day  </span></span>
<span id="cb195-8"><a href="dplyr.html#cb195-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;    &lt;chr&gt;             &lt;chr&gt;        &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt;</span></span>
<span id="cb195-9"><a href="dplyr.html#cb195-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21.06.2… &quot;Nach Hausfriede… Ereignisort… 2021-06-21 15:17:00  2021 Jun   Mo   </span></span>
<span id="cb195-10"><a href="dplyr.html#cb195-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21.06.2… &quot;Marzena MÄRZ ve… Ereignisort… 2021-06-21 13:35:00  2021 Jun   Mo   </span></span>
<span id="cb195-11"><a href="dplyr.html#cb195-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21.06.2… &quot;Mehrere Verletz… Ereignisort… 2021-06-21 13:19:00  2021 Jun   Mo   </span></span>
<span id="cb195-12"><a href="dplyr.html#cb195-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21.06.2… &quot;Streit eskalier… Ereignisort… 2021-06-21 13:17:00  2021 Jun   Mo   </span></span>
<span id="cb195-13"><a href="dplyr.html#cb195-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21.06.2… &quot;Fünf Verletzte … Ereignisort… 2021-06-21 10:41:00  2021 Jun   Mo   </span></span>
<span id="cb195-14"><a href="dplyr.html#cb195-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21.06.2… &quot;Zivilstreife st… Ereignisort… 2021-06-21 10:30:00  2021 Jun   Mo   </span></span>
<span id="cb195-15"><a href="dplyr.html#cb195-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21.06.2… &quot;In Jugendeinric… Ereignisort… 2021-06-21 09:55:00  2021 Jun   Mo   </span></span>
<span id="cb195-16"><a href="dplyr.html#cb195-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20.06.2… &quot;Mehrere Verletz… Ereignisort… 2021-06-20 13:30:00  2021 Jun   So   </span></span>
<span id="cb195-17"><a href="dplyr.html#cb195-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20.06.2… &quot;Gemeinsame Meld… Ereignisort… 2021-06-20 12:12:00  2021 Jun   So   </span></span>
<span id="cb195-18"><a href="dplyr.html#cb195-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20.06.2… &quot;Senior mit Fahr… Ereignisort… 2021-06-20 11:21:00  2021 Jun   So   </span></span>
<span id="cb195-19"><a href="dplyr.html#cb195-19" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
<p>To extract the time of day, we first have to extract the substring of “Date”
that contains the time and then apply the lubridate function <code>hm()</code> to it.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="dplyr.html#cb196-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb196-2"><a href="dplyr.html#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> </span>
<span id="cb196-3"><a href="dplyr.html#cb196-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">substr</span>(Date, <span class="dv">12</span>, <span class="fu">length</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb196-4"><a href="dplyr.html#cb196-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">hm</span>()</span>
<span id="cb196-5"><a href="dplyr.html#cb196-5" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb196-6"><a href="dplyr.html#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 4</span></span>
<span id="cb196-7"><a href="dplyr.html#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    Date        Report                             District            time      </span></span>
<span id="cb196-8"><a href="dplyr.html#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;       &lt;chr&gt;                              &lt;chr&gt;               &lt;Period&gt;  </span></span>
<span id="cb196-9"><a href="dplyr.html#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21.06.2021… &quot;Nach Hausfriedensbruch Widerstan… Ereignisort: Marza… 15H 17M 0S</span></span>
<span id="cb196-10"><a href="dplyr.html#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21.06.2021… &quot;Marzena MÄRZ vermisst – Polizei … Ereignisort: Reini… 13H 35M 0S</span></span>
<span id="cb196-11"><a href="dplyr.html#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21.06.2021… &quot;Mehrere Verletzte nach Schüssen … Ereignisort: Mitte  13H 19M 0S</span></span>
<span id="cb196-12"><a href="dplyr.html#cb196-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21.06.2021… &quot;Streit eskalierte&quot;                Ereignisort: Licht… 13H 17M 0S</span></span>
<span id="cb196-13"><a href="dplyr.html#cb196-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21.06.2021… &quot;Fünf Verletzte bei Unfall &quot;       Ereignisort: Tempe… 10H 41M 0S</span></span>
<span id="cb196-14"><a href="dplyr.html#cb196-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21.06.2021… &quot;Zivilstreife stoppt Raser&quot;        Ereignisort: Charl… 10H 30M 0S</span></span>
<span id="cb196-15"><a href="dplyr.html#cb196-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21.06.2021… &quot;In Jugendeinrichtung randaliert … Ereignisort: Spand… 9H 55M 0S </span></span>
<span id="cb196-16"><a href="dplyr.html#cb196-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20.06.2021… &quot;Mehrere Verletzte nach Messerang… Ereignisort: Fried… 13H 30M 0S</span></span>
<span id="cb196-17"><a href="dplyr.html#cb196-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20.06.2021… &quot;Gemeinsame Meldung mit der Staat… Ereignisort: Mitte  12H 12M 0S</span></span>
<span id="cb196-18"><a href="dplyr.html#cb196-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20.06.2021… &quot;Senior mit Fahrrad gestürzt und … Ereignisort: Spand… 11H 21M 0S</span></span>
<span id="cb196-19"><a href="dplyr.html#cb196-19" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
<p>We can combine all these individual steps in one pipe and apply them to the
object <code>reports</code>.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="dplyr.html#cb197-1" aria-hidden="true" tabindex="-1"></a>reports <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb197-2"><a href="dplyr.html#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District =</span> <span class="fu">substr</span>(District, <span class="dv">14</span>, <span class="fu">length</span>(District))) <span class="sc">%&gt;%</span> </span>
<span id="cb197-3"><a href="dplyr.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_cmpl =</span> <span class="fu">dmy_hm</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-4"><a href="dplyr.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date_cmpl)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-5"><a href="dplyr.html#cb197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-6"><a href="dplyr.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day =</span> <span class="fu">wday</span>(date_cmpl, <span class="at">label =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-7"><a href="dplyr.html#cb197-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> </span>
<span id="cb197-8"><a href="dplyr.html#cb197-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">substr</span>(Date, <span class="dv">12</span>, <span class="fu">length</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-9"><a href="dplyr.html#cb197-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">hm</span>()</span>
<span id="cb197-10"><a href="dplyr.html#cb197-10" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb197-11"><a href="dplyr.html#cb197-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-12"><a href="dplyr.html#cb197-12" aria-hidden="true" tabindex="-1"></a>reports</span>
<span id="cb197-13"><a href="dplyr.html#cb197-13" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 8</span></span>
<span id="cb197-14"><a href="dplyr.html#cb197-14" aria-hidden="true" tabindex="-1"></a><span class="do">##    Date    Report     District  date_cmpl            year month day   time      </span></span>
<span id="cb197-15"><a href="dplyr.html#cb197-15" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb197-16"><a href="dplyr.html#cb197-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21.06.… &quot;Nach Hau… Marzahn-… 2021-06-21 15:17:00  2021 Jun   Mo    15H 17M 0S</span></span>
<span id="cb197-17"><a href="dplyr.html#cb197-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21.06.… &quot;Marzena … Reinicke… 2021-06-21 13:35:00  2021 Jun   Mo    13H 35M 0S</span></span>
<span id="cb197-18"><a href="dplyr.html#cb197-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21.06.… &quot;Mehrere … Mitte     2021-06-21 13:19:00  2021 Jun   Mo    13H 19M 0S</span></span>
<span id="cb197-19"><a href="dplyr.html#cb197-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21.06.… &quot;Streit e… Lichtenb… 2021-06-21 13:17:00  2021 Jun   Mo    13H 17M 0S</span></span>
<span id="cb197-20"><a href="dplyr.html#cb197-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21.06.… &quot;Fünf Ver… Tempelho… 2021-06-21 10:41:00  2021 Jun   Mo    10H 41M 0S</span></span>
<span id="cb197-21"><a href="dplyr.html#cb197-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21.06.… &quot;Zivilstr… Charlott… 2021-06-21 10:30:00  2021 Jun   Mo    10H 30M 0S</span></span>
<span id="cb197-22"><a href="dplyr.html#cb197-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21.06.… &quot;In Jugen… Spandau   2021-06-21 09:55:00  2021 Jun   Mo    9H 55M 0S </span></span>
<span id="cb197-23"><a href="dplyr.html#cb197-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20.06.… &quot;Mehrere … Friedric… 2021-06-20 13:30:00  2021 Jun   So    13H 30M 0S</span></span>
<span id="cb197-24"><a href="dplyr.html#cb197-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20.06.… &quot;Gemeinsa… Mitte     2021-06-20 12:12:00  2021 Jun   So    12H 12M 0S</span></span>
<span id="cb197-25"><a href="dplyr.html#cb197-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20.06.… &quot;Senior m… Spandau   2021-06-20 11:21:00  2021 Jun   So    11H 21M 0S</span></span>
<span id="cb197-26"><a href="dplyr.html#cb197-26" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
</div>
</div>
<div id="select" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> <code>select()</code></h2>
<p>As we have already extracted all we need from the “Date” column, and we will not
work with the “Report” column in this chapter, to keep the tibble neat and free
of clutter, we remove both columns by using the function <code>select()</code>. The
function takes the data as its first argument – here provided by the pipe –
and one or several names of columns that should be kept. If columns follow after
each other in order, we can also use a “from:to” notation.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="dplyr.html#cb198-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb198-2"><a href="dplyr.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(District, date_cmpl, year, month, day, time)</span>
<span id="cb198-3"><a href="dplyr.html#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 6</span></span>
<span id="cb198-4"><a href="dplyr.html#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    District                   date_cmpl            year month day   time      </span></span>
<span id="cb198-5"><a href="dplyr.html#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb198-6"><a href="dplyr.html#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf        2021-06-21 15:17:00  2021 Jun   Mo    15H 17M 0S</span></span>
<span id="cb198-7"><a href="dplyr.html#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Reinickendorf              2021-06-21 13:35:00  2021 Jun   Mo    13H 35M 0S</span></span>
<span id="cb198-8"><a href="dplyr.html#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Mitte                      2021-06-21 13:19:00  2021 Jun   Mo    13H 19M 0S</span></span>
<span id="cb198-9"><a href="dplyr.html#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Lichtenberg                2021-06-21 13:17:00  2021 Jun   Mo    13H 17M 0S</span></span>
<span id="cb198-10"><a href="dplyr.html#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg       2021-06-21 10:41:00  2021 Jun   Mo    10H 41M 0S</span></span>
<span id="cb198-11"><a href="dplyr.html#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf 2021-06-21 10:30:00  2021 Jun   Mo    10H 30M 0S</span></span>
<span id="cb198-12"><a href="dplyr.html#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Spandau                    2021-06-21 09:55:00  2021 Jun   Mo    9H 55M 0S </span></span>
<span id="cb198-13"><a href="dplyr.html#cb198-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Friedrichshain-Kreuzberg   2021-06-20 13:30:00  2021 Jun   So    13H 30M 0S</span></span>
<span id="cb198-14"><a href="dplyr.html#cb198-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Mitte                      2021-06-20 12:12:00  2021 Jun   So    12H 12M 0S</span></span>
<span id="cb198-15"><a href="dplyr.html#cb198-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Spandau                    2021-06-20 11:21:00  2021 Jun   So    11H 21M 0S</span></span>
<span id="cb198-16"><a href="dplyr.html#cb198-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span>
<span id="cb198-17"><a href="dplyr.html#cb198-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-18"><a href="dplyr.html#cb198-18" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb198-19"><a href="dplyr.html#cb198-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(District<span class="sc">:</span>time)</span>
<span id="cb198-20"><a href="dplyr.html#cb198-20" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 6</span></span>
<span id="cb198-21"><a href="dplyr.html#cb198-21" aria-hidden="true" tabindex="-1"></a><span class="do">##    District                   date_cmpl            year month day   time      </span></span>
<span id="cb198-22"><a href="dplyr.html#cb198-22" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb198-23"><a href="dplyr.html#cb198-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf        2021-06-21 15:17:00  2021 Jun   Mo    15H 17M 0S</span></span>
<span id="cb198-24"><a href="dplyr.html#cb198-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Reinickendorf              2021-06-21 13:35:00  2021 Jun   Mo    13H 35M 0S</span></span>
<span id="cb198-25"><a href="dplyr.html#cb198-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Mitte                      2021-06-21 13:19:00  2021 Jun   Mo    13H 19M 0S</span></span>
<span id="cb198-26"><a href="dplyr.html#cb198-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Lichtenberg                2021-06-21 13:17:00  2021 Jun   Mo    13H 17M 0S</span></span>
<span id="cb198-27"><a href="dplyr.html#cb198-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg       2021-06-21 10:41:00  2021 Jun   Mo    10H 41M 0S</span></span>
<span id="cb198-28"><a href="dplyr.html#cb198-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf 2021-06-21 10:30:00  2021 Jun   Mo    10H 30M 0S</span></span>
<span id="cb198-29"><a href="dplyr.html#cb198-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Spandau                    2021-06-21 09:55:00  2021 Jun   Mo    9H 55M 0S </span></span>
<span id="cb198-30"><a href="dplyr.html#cb198-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Friedrichshain-Kreuzberg   2021-06-20 13:30:00  2021 Jun   So    13H 30M 0S</span></span>
<span id="cb198-31"><a href="dplyr.html#cb198-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Mitte                      2021-06-20 12:12:00  2021 Jun   So    12H 12M 0S</span></span>
<span id="cb198-32"><a href="dplyr.html#cb198-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Spandau                    2021-06-20 11:21:00  2021 Jun   So    11H 21M 0S</span></span>
<span id="cb198-33"><a href="dplyr.html#cb198-33" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
<p>Instead of telling <code>select()</code> which columns we want to keep, we can also tell it
which ones not to keep by adding a <code>-</code> before the column names. In this last
example we will assign the result to <code>reports</code>.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="dplyr.html#cb199-1" aria-hidden="true" tabindex="-1"></a>reports <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb199-2"><a href="dplyr.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Date, Report))</span>
<span id="cb199-3"><a href="dplyr.html#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="dplyr.html#cb199-4" aria-hidden="true" tabindex="-1"></a>reports</span>
<span id="cb199-5"><a href="dplyr.html#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 6</span></span>
<span id="cb199-6"><a href="dplyr.html#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    District                   date_cmpl            year month day   time      </span></span>
<span id="cb199-7"><a href="dplyr.html#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb199-8"><a href="dplyr.html#cb199-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf        2021-06-21 15:17:00  2021 Jun   Mo    15H 17M 0S</span></span>
<span id="cb199-9"><a href="dplyr.html#cb199-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Reinickendorf              2021-06-21 13:35:00  2021 Jun   Mo    13H 35M 0S</span></span>
<span id="cb199-10"><a href="dplyr.html#cb199-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Mitte                      2021-06-21 13:19:00  2021 Jun   Mo    13H 19M 0S</span></span>
<span id="cb199-11"><a href="dplyr.html#cb199-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Lichtenberg                2021-06-21 13:17:00  2021 Jun   Mo    13H 17M 0S</span></span>
<span id="cb199-12"><a href="dplyr.html#cb199-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg       2021-06-21 10:41:00  2021 Jun   Mo    10H 41M 0S</span></span>
<span id="cb199-13"><a href="dplyr.html#cb199-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf 2021-06-21 10:30:00  2021 Jun   Mo    10H 30M 0S</span></span>
<span id="cb199-14"><a href="dplyr.html#cb199-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Spandau                    2021-06-21 09:55:00  2021 Jun   Mo    9H 55M 0S </span></span>
<span id="cb199-15"><a href="dplyr.html#cb199-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Friedrichshain-Kreuzberg   2021-06-20 13:30:00  2021 Jun   So    13H 30M 0S</span></span>
<span id="cb199-16"><a href="dplyr.html#cb199-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Mitte                      2021-06-20 12:12:00  2021 Jun   So    12H 12M 0S</span></span>
<span id="cb199-17"><a href="dplyr.html#cb199-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Spandau                    2021-06-20 11:21:00  2021 Jun   So    11H 21M 0S</span></span>
<span id="cb199-18"><a href="dplyr.html#cb199-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
</div>
<div id="rename" class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> <code>rename()</code></h2>
<p>As you may have noticed, all newly created columns are written in lower case,
while “District” begins with an upper case letter. You may want to rename this
column to a lower case name – or all the others to upper case names, depending
on your preference.</p>
<p>One approach to renaming is using the function <code>rename()</code> from dplyr: the
function takes the data to be applied to as its first argument – passed on by
the pipe in this case – followed by one or more arguments in the form
<code>new_name = old_name</code>.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="dplyr.html#cb200-1" aria-hidden="true" tabindex="-1"></a>reports <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb200-2"><a href="dplyr.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">district =</span> District)</span>
<span id="cb200-3"><a href="dplyr.html#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="dplyr.html#cb200-4" aria-hidden="true" tabindex="-1"></a>reports</span>
<span id="cb200-5"><a href="dplyr.html#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16,698 x 6</span></span>
<span id="cb200-6"><a href="dplyr.html#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    district                   date_cmpl            year month day   time      </span></span>
<span id="cb200-7"><a href="dplyr.html#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb200-8"><a href="dplyr.html#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Marzahn-Hellersdorf        2021-06-21 15:17:00  2021 Jun   Mo    15H 17M 0S</span></span>
<span id="cb200-9"><a href="dplyr.html#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Reinickendorf              2021-06-21 13:35:00  2021 Jun   Mo    13H 35M 0S</span></span>
<span id="cb200-10"><a href="dplyr.html#cb200-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Mitte                      2021-06-21 13:19:00  2021 Jun   Mo    13H 19M 0S</span></span>
<span id="cb200-11"><a href="dplyr.html#cb200-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Lichtenberg                2021-06-21 13:17:00  2021 Jun   Mo    13H 17M 0S</span></span>
<span id="cb200-12"><a href="dplyr.html#cb200-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg       2021-06-21 10:41:00  2021 Jun   Mo    10H 41M 0S</span></span>
<span id="cb200-13"><a href="dplyr.html#cb200-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Charlottenburg-Wilmersdorf 2021-06-21 10:30:00  2021 Jun   Mo    10H 30M 0S</span></span>
<span id="cb200-14"><a href="dplyr.html#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Spandau                    2021-06-21 09:55:00  2021 Jun   Mo    9H 55M 0S </span></span>
<span id="cb200-15"><a href="dplyr.html#cb200-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Friedrichshain-Kreuzberg   2021-06-20 13:30:00  2021 Jun   So    13H 30M 0S</span></span>
<span id="cb200-16"><a href="dplyr.html#cb200-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Mitte                      2021-06-20 12:12:00  2021 Jun   So    12H 12M 0S</span></span>
<span id="cb200-17"><a href="dplyr.html#cb200-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Spandau                    2021-06-20 11:21:00  2021 Jun   So    11H 21M 0S</span></span>
<span id="cb200-18"><a href="dplyr.html#cb200-18" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 16,688 more rows</span></span></code></pre></div>
</div>
<div id="filter" class="section level2" number="11.4">
<h2><span class="header-section-number">11.4</span> <code>filter()</code></h2>
<p>Some of our analysis requires us to have complete years in our data. If we want
to compare the police reports by year, it makes no sense to compare the numbers
for an ongoing year with those that are complete, since the former will
obviously have fewer reports. Incomplete years would also impact analysis by
month, as some months will have more observations than others; therefore, we
should filter our data for complete years.</p>
<p>To filter the observations, we can use the function <code>filter()</code>. As always in
tidyverse functions, <code>filter()</code> takes the data to be filtered as its first
argument and one or multiple expressions that specify the rules by which to
filter. To write these expressions, we can make use of the comparison operators
discussed in subchapter <a href="R1.html#comparison">2.3.2</a>.</p>
<p>To filter for all years that are not 2021, we can write:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="dplyr.html#cb201-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb201-2"><a href="dplyr.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2021</span>)</span>
<span id="cb201-3"><a href="dplyr.html#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 15,480 x 6</span></span>
<span id="cb201-4"><a href="dplyr.html#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    district                   date_cmpl            year month day   time      </span></span>
<span id="cb201-5"><a href="dplyr.html#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb201-6"><a href="dplyr.html#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Lichtenberg                2020-12-31 14:13:00  2020 Dez   Do    14H 13M 0S</span></span>
<span id="cb201-7"><a href="dplyr.html#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Charlottenburg-Wilmersdorf 2020-12-31 14:06:00  2020 Dez   Do    14H 6M 0S </span></span>
<span id="cb201-8"><a href="dplyr.html#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Neukölln                   2020-12-31 13:31:00  2020 Dez   Do    13H 31M 0S</span></span>
<span id="cb201-9"><a href="dplyr.html#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Tempelhof-Schöneberg       2020-12-31 11:33:00  2020 Dez   Do    11H 33M 0S</span></span>
<span id="cb201-10"><a href="dplyr.html#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Marzahn-Hellersdorf        2020-12-31 11:26:00  2020 Dez   Do    11H 26M 0S</span></span>
<span id="cb201-11"><a href="dplyr.html#cb201-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Neukölln                   2020-12-31 11:05:00  2020 Dez   Do    11H 5M 0S </span></span>
<span id="cb201-12"><a href="dplyr.html#cb201-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Steglitz-Zehlendorf        2020-12-31 11:00:00  2020 Dez   Do    11H 0M 0S </span></span>
<span id="cb201-13"><a href="dplyr.html#cb201-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Treptow-Köpenick           2020-12-31 10:58:00  2020 Dez   Do    10H 58M 0S</span></span>
<span id="cb201-14"><a href="dplyr.html#cb201-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Neukölln                   2020-12-30 15:51:00  2020 Dez   Mi    15H 51M 0S</span></span>
<span id="cb201-15"><a href="dplyr.html#cb201-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Mitte                      2020-12-30 13:10:00  2020 Dez   Mi    13H 10M 0S</span></span>
<span id="cb201-16"><a href="dplyr.html#cb201-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 15,470 more rows</span></span></code></pre></div>
<p>Thus, only the observations where “year” does not equal “2021” remain in the
tibble; in other words, those observations for which the expression
<code>year != 2021</code> is returned as <code>TRUE</code>.</p>
<p>Closer inspection of the data reveals, that 2014 (the first year that is
available on the website) is not complete either. There also seems to be one
single report for 2013. We should also exclude these years for analysis. We can
chain multiple expressions when using <code>filter()</code> separated by commas.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="dplyr.html#cb202-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb202-2"><a href="dplyr.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2021</span>, year <span class="sc">!=</span> <span class="dv">2014</span>, year <span class="sc">!=</span> <span class="dv">2013</span>)</span>
<span id="cb202-3"><a href="dplyr.html#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 14,777 x 6</span></span>
<span id="cb202-4"><a href="dplyr.html#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    district                   date_cmpl            year month day   time      </span></span>
<span id="cb202-5"><a href="dplyr.html#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                      &lt;dttm&gt;              &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;Period&gt;  </span></span>
<span id="cb202-6"><a href="dplyr.html#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Lichtenberg                2020-12-31 14:13:00  2020 Dez   Do    14H 13M 0S</span></span>
<span id="cb202-7"><a href="dplyr.html#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Charlottenburg-Wilmersdorf 2020-12-31 14:06:00  2020 Dez   Do    14H 6M 0S </span></span>
<span id="cb202-8"><a href="dplyr.html#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Neukölln                   2020-12-31 13:31:00  2020 Dez   Do    13H 31M 0S</span></span>
<span id="cb202-9"><a href="dplyr.html#cb202-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Tempelhof-Schöneberg       2020-12-31 11:33:00  2020 Dez   Do    11H 33M 0S</span></span>
<span id="cb202-10"><a href="dplyr.html#cb202-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Marzahn-Hellersdorf        2020-12-31 11:26:00  2020 Dez   Do    11H 26M 0S</span></span>
<span id="cb202-11"><a href="dplyr.html#cb202-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Neukölln                   2020-12-31 11:05:00  2020 Dez   Do    11H 5M 0S </span></span>
<span id="cb202-12"><a href="dplyr.html#cb202-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Steglitz-Zehlendorf        2020-12-31 11:00:00  2020 Dez   Do    11H 0M 0S </span></span>
<span id="cb202-13"><a href="dplyr.html#cb202-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Treptow-Köpenick           2020-12-31 10:58:00  2020 Dez   Do    10H 58M 0S</span></span>
<span id="cb202-14"><a href="dplyr.html#cb202-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Neukölln                   2020-12-30 15:51:00  2020 Dez   Mi    15H 51M 0S</span></span>
<span id="cb202-15"><a href="dplyr.html#cb202-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Mitte                      2020-12-30 13:10:00  2020 Dez   Mi    13H 10M 0S</span></span>
<span id="cb202-16"><a href="dplyr.html#cb202-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 14,767 more rows</span></span></code></pre></div>
<p>Often there are multiple ways to formulate the filtering expressions. Here, we
could tell R which values for “year” we want to keep, instead of which we do not
want to keep. Instead of listing all those individual years, we can use <code>%in%</code>
to define a range of numerical values which should be kept when filtering. We
assign the result to a new object for later use.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="dplyr.html#cb203-1" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="ot">&lt;-</span> reports <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="dplyr.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2020</span>)</span></code></pre></div>
<p>While the <code>,</code> behaves like the logical operator <code>&amp;</code>, we can also use <code>|</code> for
“or” when combining expressions to be filtered upon.</p>
</div>
<div id="summarise-group_by" class="section level2" number="11.5">
<h2><span class="header-section-number">11.5</span> <code>summarise()</code> &amp; <code>group_by()</code></h2>
<p>We can now begin computing some basic summary statistics for our data. You
should note though, that we do not know how the data we scraped is actually
created. Do the dates and times on the website refer to the instance in time
when a crime occurred – there are indications that this is not the case –,
when a report was filed, or even when the PR team of the Berlin police uploaded
the report to the website – which might even be the most plausible scenario?
Also, are all crimes reported on this website – the daily numbers are too low
for this to be the case – or is there an internal selection process? And if so,
on what criteria does the selection occur? If this was a real research project,
we would absolutely need to gain clarity on these and many other questions,
before we even begin with collecting the data. We do not have clarity here, but
we have to keep in mind that we may not analyse the statistical distribution of
crimes in Berlin, but rather the working practice of the PR team.</p>
<div id="number-of-reports-by-groups" class="section level3" number="11.5.1">
<h3><span class="header-section-number">11.5.1</span> Number of reports by groups</h3>
<p>The dplyr function <code>summarise()</code> can be used to calculate summary statistics for
a whole tibble; the syntax being similar to <code>mutate()</code>. The result is a new
tibble, containing only the summary statistics we requested. We are often
interested in summaries grouped by the value of one or more other variables. We
might ask ourselves, if there are differences in the number of released police
reports by year; for this purpose, we can group the data by the values of the
“year” column using <code>group_by()</code> and then compute the summary statistics
separately for each group. The function we use for the summary statistic here is
<code>n()</code>, which returns the size of each group. As each observation represents one
police report, the group size equals the number of reports. As always with dplyr
functions, <code>group_by()</code> needs the data which will be grouped as the first
argument, followed by one or multiple columns to group by.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="dplyr.html#cb204-1" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb204-2"><a href="dplyr.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb204-3"><a href="dplyr.html#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb204-4"><a href="dplyr.html#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 x 2</span></span>
<span id="cb204-5"><a href="dplyr.html#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    year reports</span></span>
<span id="cb204-6"><a href="dplyr.html#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="do">## * &lt;dbl&gt;   &lt;int&gt;</span></span>
<span id="cb204-7"><a href="dplyr.html#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  2015    2369</span></span>
<span id="cb204-8"><a href="dplyr.html#cb204-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  2016    2625</span></span>
<span id="cb204-9"><a href="dplyr.html#cb204-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  2017    2232</span></span>
<span id="cb204-10"><a href="dplyr.html#cb204-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  2018    2343</span></span>
<span id="cb204-11"><a href="dplyr.html#cb204-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  2019    2622</span></span>
<span id="cb204-12"><a href="dplyr.html#cb204-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  2020    2586</span></span></code></pre></div>
<p>While there are differences between the years, there does not seem to be a
systematic pattern to it. We can do the same kind of analysis grouped by months
and weekdays.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="dplyr.html#cb205-1" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb205-2"><a href="dplyr.html#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb205-3"><a href="dplyr.html#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb205-4"><a href="dplyr.html#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 2</span></span>
<span id="cb205-5"><a href="dplyr.html#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    month reports</span></span>
<span id="cb205-6"><a href="dplyr.html#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  * &lt;ord&gt;   &lt;int&gt;</span></span>
<span id="cb205-7"><a href="dplyr.html#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Jan      1311</span></span>
<span id="cb205-8"><a href="dplyr.html#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Feb      1154</span></span>
<span id="cb205-9"><a href="dplyr.html#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Mär      1251</span></span>
<span id="cb205-10"><a href="dplyr.html#cb205-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Apr      1216</span></span>
<span id="cb205-11"><a href="dplyr.html#cb205-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Mai      1331</span></span>
<span id="cb205-12"><a href="dplyr.html#cb205-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Jun      1202</span></span>
<span id="cb205-13"><a href="dplyr.html#cb205-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Jul      1203</span></span>
<span id="cb205-14"><a href="dplyr.html#cb205-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Aug      1248</span></span>
<span id="cb205-15"><a href="dplyr.html#cb205-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Sep      1234</span></span>
<span id="cb205-16"><a href="dplyr.html#cb205-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Okt      1246</span></span>
<span id="cb205-17"><a href="dplyr.html#cb205-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Nov      1188</span></span>
<span id="cb205-18"><a href="dplyr.html#cb205-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Dez      1193</span></span>
<span id="cb205-19"><a href="dplyr.html#cb205-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-20"><a href="dplyr.html#cb205-20" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb205-21"><a href="dplyr.html#cb205-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(day) <span class="sc">%&gt;%</span> </span>
<span id="cb205-22"><a href="dplyr.html#cb205-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb205-23"><a href="dplyr.html#cb205-23" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 7 x 2</span></span>
<span id="cb205-24"><a href="dplyr.html#cb205-24" aria-hidden="true" tabindex="-1"></a><span class="do">##   day   reports</span></span>
<span id="cb205-25"><a href="dplyr.html#cb205-25" aria-hidden="true" tabindex="-1"></a><span class="do">## * &lt;ord&gt;   &lt;int&gt;</span></span>
<span id="cb205-26"><a href="dplyr.html#cb205-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 So       2088</span></span>
<span id="cb205-27"><a href="dplyr.html#cb205-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Mo       2044</span></span>
<span id="cb205-28"><a href="dplyr.html#cb205-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Di       2093</span></span>
<span id="cb205-29"><a href="dplyr.html#cb205-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Mi       2175</span></span>
<span id="cb205-30"><a href="dplyr.html#cb205-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Do       2174</span></span>
<span id="cb205-31"><a href="dplyr.html#cb205-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Fr       2211</span></span>
<span id="cb205-32"><a href="dplyr.html#cb205-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 Sa       1992</span></span></code></pre></div>
<p>The analysis by month again shows no systematic variation. Looking at the
reports by day of the week on the other hand, shows a slight increase in reports
over the week, culminating on Friday. As stated above, we don not really know
how the data is created, so the main point to take away from this analysis might
be, that the PR team of the Berlin police also works on the weekend.</p>
<p>In the same manner, we can analyse the number of released police reports by
district.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="dplyr.html#cb206-1" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb206-2"><a href="dplyr.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district) <span class="sc">%&gt;%</span> </span>
<span id="cb206-3"><a href="dplyr.html#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb206-4"><a href="dplyr.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 22 x 2</span></span>
<span id="cb206-5"><a href="dplyr.html#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    district                     reports</span></span>
<span id="cb206-6"><a href="dplyr.html#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  * &lt;chr&gt;                          &lt;int&gt;</span></span>
<span id="cb206-7"><a href="dplyr.html#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 berlinweit                       209</span></span>
<span id="cb206-8"><a href="dplyr.html#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 bezirksübergreifend              724</span></span>
<span id="cb206-9"><a href="dplyr.html#cb206-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 bundesweit                        32</span></span>
<span id="cb206-10"><a href="dplyr.html#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Charlottenburg - Wilmersdorf     514</span></span>
<span id="cb206-11"><a href="dplyr.html#cb206-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Charlottenburg-Wilmersdorf       869</span></span>
<span id="cb206-12"><a href="dplyr.html#cb206-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Friedrichshain - Kreuzberg       577</span></span>
<span id="cb206-13"><a href="dplyr.html#cb206-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Friedrichshain-Kreuzberg        1025</span></span>
<span id="cb206-14"><a href="dplyr.html#cb206-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Lichtenberg                      769</span></span>
<span id="cb206-15"><a href="dplyr.html#cb206-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Marzahn - Hellersdorf            225</span></span>
<span id="cb206-16"><a href="dplyr.html#cb206-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Marzahn-Hellersdorf              495</span></span>
<span id="cb206-17"><a href="dplyr.html#cb206-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 12 more rows</span></span></code></pre></div>
<p>Before we interpret the result, let us examine the district names; districts
with a dash are written in two ways: with whitespace around the dash and without
one. There may have been a change in the way these names are recorded in the data
over the years and we have to deal with it. We can use the function
<code>str_remove_all()</code> to remove every occurrence of a pattern we specify as its
argument. If we remove the pattern " " we basically delete all whitespace. This
can again be combined with <code>mutate()</code> to transform the data in our tibble.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="dplyr.html#cb207-1" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="ot">&lt;-</span> reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb207-2"><a href="dplyr.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">str_remove_all</span>(district, <span class="at">pattern =</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb207-3"><a href="dplyr.html#cb207-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-4"><a href="dplyr.html#cb207-4" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb207-5"><a href="dplyr.html#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district) <span class="sc">%&gt;%</span> </span>
<span id="cb207-6"><a href="dplyr.html#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb207-7"><a href="dplyr.html#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(reports))</span>
<span id="cb207-8"><a href="dplyr.html#cb207-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16 x 2</span></span>
<span id="cb207-9"><a href="dplyr.html#cb207-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    district                   reports</span></span>
<span id="cb207-10"><a href="dplyr.html#cb207-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                        &lt;int&gt;</span></span>
<span id="cb207-11"><a href="dplyr.html#cb207-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Mitte                         2291</span></span>
<span id="cb207-12"><a href="dplyr.html#cb207-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Friedrichshain-Kreuzberg      1602</span></span>
<span id="cb207-13"><a href="dplyr.html#cb207-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Charlottenburg-Wilmersdorf    1383</span></span>
<span id="cb207-14"><a href="dplyr.html#cb207-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Neukölln                      1310</span></span>
<span id="cb207-15"><a href="dplyr.html#cb207-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg          1197</span></span>
<span id="cb207-16"><a href="dplyr.html#cb207-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Pankow                        1096</span></span>
<span id="cb207-17"><a href="dplyr.html#cb207-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Treptow-Köpenick               909</span></span>
<span id="cb207-18"><a href="dplyr.html#cb207-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Reinickendorf                  791</span></span>
<span id="cb207-19"><a href="dplyr.html#cb207-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Lichtenberg                    769</span></span>
<span id="cb207-20"><a href="dplyr.html#cb207-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 bezirksübergreifend            724</span></span>
<span id="cb207-21"><a href="dplyr.html#cb207-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Marzahn-Hellersdorf            720</span></span>
<span id="cb207-22"><a href="dplyr.html#cb207-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Spandau                        716</span></span>
<span id="cb207-23"><a href="dplyr.html#cb207-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 Steglitz-Zehlendorf            683</span></span>
<span id="cb207-24"><a href="dplyr.html#cb207-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 &lt;NA&gt;                           345</span></span>
<span id="cb207-25"><a href="dplyr.html#cb207-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 berlinweit                     209</span></span>
<span id="cb207-26"><a href="dplyr.html#cb207-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 bundesweit                      32</span></span></code></pre></div>
<p>For the group summary we also included <code>arrange(desc())</code> which orders the values
from highest to lowest. If you omit <code>desc()</code> the order is reversed.</p>
<p>We might also be interested in the relative share of reports by district. To
compute those, one option is to add another column to the tibble resulting from
<code>summarise()</code>, in which we calculate the relative share by dividing the
“reports” columns values by the total of this column.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="dplyr.html#cb208-1" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb208-2"><a href="dplyr.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district) <span class="sc">%&gt;%</span> </span>
<span id="cb208-3"><a href="dplyr.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb208-4"><a href="dplyr.html#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(reports)) <span class="sc">%&gt;%</span> </span>
<span id="cb208-5"><a href="dplyr.html#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reports_rel =</span> reports <span class="sc">/</span> <span class="fu">sum</span>(reports))</span>
<span id="cb208-6"><a href="dplyr.html#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 16 x 3</span></span>
<span id="cb208-7"><a href="dplyr.html#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    district                   reports reports_rel</span></span>
<span id="cb208-8"><a href="dplyr.html#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                        &lt;int&gt;       &lt;dbl&gt;</span></span>
<span id="cb208-9"><a href="dplyr.html#cb208-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Mitte                         2291     0.155  </span></span>
<span id="cb208-10"><a href="dplyr.html#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Friedrichshain-Kreuzberg      1602     0.108  </span></span>
<span id="cb208-11"><a href="dplyr.html#cb208-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Charlottenburg-Wilmersdorf    1383     0.0936 </span></span>
<span id="cb208-12"><a href="dplyr.html#cb208-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Neukölln                      1310     0.0887 </span></span>
<span id="cb208-13"><a href="dplyr.html#cb208-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Tempelhof-Schöneberg          1197     0.0810 </span></span>
<span id="cb208-14"><a href="dplyr.html#cb208-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Pankow                        1096     0.0742 </span></span>
<span id="cb208-15"><a href="dplyr.html#cb208-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Treptow-Köpenick               909     0.0615 </span></span>
<span id="cb208-16"><a href="dplyr.html#cb208-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Reinickendorf                  791     0.0535 </span></span>
<span id="cb208-17"><a href="dplyr.html#cb208-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Lichtenberg                    769     0.0520 </span></span>
<span id="cb208-18"><a href="dplyr.html#cb208-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 bezirksübergreifend            724     0.0490 </span></span>
<span id="cb208-19"><a href="dplyr.html#cb208-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Marzahn-Hellersdorf            720     0.0487 </span></span>
<span id="cb208-20"><a href="dplyr.html#cb208-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Spandau                        716     0.0485 </span></span>
<span id="cb208-21"><a href="dplyr.html#cb208-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 Steglitz-Zehlendorf            683     0.0462 </span></span>
<span id="cb208-22"><a href="dplyr.html#cb208-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 &lt;NA&gt;                           345     0.0233 </span></span>
<span id="cb208-23"><a href="dplyr.html#cb208-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 berlinweit                     209     0.0141 </span></span>
<span id="cb208-24"><a href="dplyr.html#cb208-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 bundesweit                      32     0.00217</span></span></code></pre></div>
<p>Whether we look at the absolute or relative values, it is clear that there are
differences between the districts in the number of police reports released and
that the values for the district “Mitte” are considerably higher compared to the
others. Again, we do not know how the data is created, so maybe it is just the
case that the crimes in “Mitte” are more interesting than in other districts and
that the data does not necessarily point to a higher number of crimes in central
Berlin.</p>
<p>Using <code>group_by()</code> we can also group by multiple columns. “Mitte” and
“Friedrichshain-Kreuzberg” showed the highest numbers among all districts. Let
us analyse if these numbers changed over the years for these two districts.
First we have to use <code>filter()</code> to use only the observations referring to those
districts and then group the data by the remaining districts and year before we
count the the number of released reports.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="dplyr.html#cb209-1" aria-hidden="true" tabindex="-1"></a>reports_fyears <span class="sc">%&gt;%</span> </span>
<span id="cb209-2"><a href="dplyr.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(district <span class="sc">==</span> <span class="st">&quot;Mitte&quot;</span> <span class="sc">|</span> district <span class="sc">==</span> <span class="st">&quot;Friedrichshain-Kreuzberg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb209-3"><a href="dplyr.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(district, year) <span class="sc">%&gt;%</span> </span>
<span id="cb209-4"><a href="dplyr.html#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">reports =</span> <span class="fu">n</span>())</span>
<span id="cb209-5"><a href="dplyr.html#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="do">## `summarise()` has grouped output by &#39;district&#39;. You can override using the `.groups` argument.</span></span>
<span id="cb209-6"><a href="dplyr.html#cb209-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 3</span></span>
<span id="cb209-7"><a href="dplyr.html#cb209-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   district [2]</span></span>
<span id="cb209-8"><a href="dplyr.html#cb209-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    district                  year reports</span></span>
<span id="cb209-9"><a href="dplyr.html#cb209-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                    &lt;dbl&gt;   &lt;int&gt;</span></span>
<span id="cb209-10"><a href="dplyr.html#cb209-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Friedrichshain-Kreuzberg  2015     277</span></span>
<span id="cb209-11"><a href="dplyr.html#cb209-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Friedrichshain-Kreuzberg  2016     269</span></span>
<span id="cb209-12"><a href="dplyr.html#cb209-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Friedrichshain-Kreuzberg  2017     233</span></span>
<span id="cb209-13"><a href="dplyr.html#cb209-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Friedrichshain-Kreuzberg  2018     237</span></span>
<span id="cb209-14"><a href="dplyr.html#cb209-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Friedrichshain-Kreuzberg  2019     285</span></span>
<span id="cb209-15"><a href="dplyr.html#cb209-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Friedrichshain-Kreuzberg  2020     301</span></span>
<span id="cb209-16"><a href="dplyr.html#cb209-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Mitte                     2015     367</span></span>
<span id="cb209-17"><a href="dplyr.html#cb209-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Mitte                     2016     448</span></span>
<span id="cb209-18"><a href="dplyr.html#cb209-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Mitte                     2017     347</span></span>
<span id="cb209-19"><a href="dplyr.html#cb209-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Mitte                     2018     363</span></span>
<span id="cb209-20"><a href="dplyr.html#cb209-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Mitte                     2019     392</span></span>
<span id="cb209-21"><a href="dplyr.html#cb209-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Mitte                     2020     374</span></span></code></pre></div>
<p>While the number of reports seems to be rather constant over the years, for
“Mitte” there is a considerable spike in 2016. To analyse this further, we had
to go deeper into the data and look at the actual texts of the police reports.</p>
<p>But we should briefly talk about a peculiarity to the way <code>group_by()</code> works
with <code>summarise()</code> that can cause headaches, if we are not aware of it. In
general, any <code>summarise()</code> function following a <code>group_by()</code> will calculate the
summary statistic and then remove one level of grouping. In the examples where
we only had one level of grouping, this essentially meant, that the data was
ungrouped after <code>summarise()</code>. In the last example we had two levels of
grouping. So, after the computation of the number of reports by “district” and
“year” the grouping by “year” was removed, but the grouping by “district”
remained in effect. We can see this in the output, where R informs us about the
column by which the data are grouped and the number of groups in the output:
<code># Groups:   district [2]</code>. Another <code>summarise()</code> function would compute the
statistic by “district” and then remove this level as well. We can also use
<code>ungroup()</code> to remove all grouping from a tibble. In the case of this example,
it does not make a practical difference as we only compute the summary and then
move on. But, if we assign the results of a summary to an object for later use,
we have to decide if we want to remove the grouping or keep it in effect,
depending on the goals of the analysis. In general, I would always ungroup the
data and group it again if the need arises, as this is less error prone and just
a minor increase in the amount of typing needed.</p>
</div>
<div id="summary-statistics-on-the-time" class="section level3" number="11.5.2">
<h3><span class="header-section-number">11.5.2</span> Summary statistics on the time</h3>
<p>The column “time” holds the time of day for each report in hours, minutes and
seconds as a representation of the actual values, which are seconds from
midnight.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="dplyr.html#cb210-1" aria-hidden="true" tabindex="-1"></a>reports_fyears[[<span class="dv">1</span>, <span class="st">&#39;time&#39;</span>]]</span>
<span id="cb210-2"><a href="dplyr.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;14H 13M 0S&quot;</span></span>
<span id="cb210-3"><a href="dplyr.html#cb210-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-4"><a href="dplyr.html#cb210-4" aria-hidden="true" tabindex="-1"></a>reports_fyears[[<span class="dv">1</span>, <span class="st">&#39;time&#39;</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb210-5"><a href="dplyr.html#cb210-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb210-6"><a href="dplyr.html#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 51180</span></span></code></pre></div>
<p>To calculate with the “time” column, we first have to tell R that we explicitly
want to use the data as seconds, then compute the summary statistic and after
this, transform the display of seconds back into the time of day. For the
transformations we can use the functions <code>period_to_seconds()</code> and
<code>seconds_to_period()</code>. We will calculate the mean and the median for the time of
day over all police reports in one call of <code>summary()</code>.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="dplyr.html#cb211-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb211-2"><a href="dplyr.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">period_to_seconds</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb211-3"><a href="dplyr.html#cb211-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mean</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb211-4"><a href="dplyr.html#cb211-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">seconds_to_period</span>(),</span>
<span id="cb211-5"><a href="dplyr.html#cb211-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">period_to_seconds</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb211-6"><a href="dplyr.html#cb211-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">median</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb211-7"><a href="dplyr.html#cb211-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">seconds_to_period</span>()</span>
<span id="cb211-8"><a href="dplyr.html#cb211-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb211-9"><a href="dplyr.html#cb211-9" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 2</span></span>
<span id="cb211-10"><a href="dplyr.html#cb211-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   mean                      median   </span></span>
<span id="cb211-11"><a href="dplyr.html#cb211-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;Period&gt;                  &lt;Period&gt; </span></span>
<span id="cb211-12"><a href="dplyr.html#cb211-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 11H 55M 47.6500179662253S 11H 1M 0S</span></span></code></pre></div>
<p>The mean time of day over all police reports is 11:55 while the median is 11:01.
This may indicate that the mean is biased towards a later time by a high number
of very late reports. We will explore this further graphically in the next
chapter. Again, the results may represent the time when crimes occur, but it is
more likely, that we are actually analysing the time when the PR team posts
their police reports.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scraping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/webscraping-tures/webscraping-tures.github.io/11-dplyr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

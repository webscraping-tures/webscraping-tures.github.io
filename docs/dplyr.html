<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Transformation with dplyr | Web Scraping using R</title>
  <meta name="description" content="10 Transformation with dplyr | Web Scraping using R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Transformation with dplyr | Web Scraping using R" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="webscraping-tures/webscraping-tures.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Transformation with dplyr | Web Scraping using R" />
  
  
  

<meta name="author" content="Jakob Tures" />


<meta name="date" content="2021-06-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="good-practice.html"/>
<link rel="next" href="ggplot.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/echarts4r-4.8.0/echarts-en.min.js"></script>
<script src="libs/echarts4r-4.8.0/ecStat.min.js"></script>
<script src="libs/echarts4r-4.8.0/dataTool.min.js"></script>
<script src="libs/echarts4r-binding-0.4.0/echarts4r.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
Web Scraping using R

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-web-scraping"><i class="fa fa-check"></i>What is web scraping?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#technical-requirements"><i class="fa fa-check"></i>Technical requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="1" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>1</b> HTML as a cornerstone of the internet</a>
<ul>
<li class="chapter" data-level="1.1" data-path="html.html"><a href="html.html#html-tags"><i class="fa fa-check"></i><b>1.1</b> HTML-Tags</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="html.html"><a href="html.html#hello_world.html"><i class="fa fa-check"></i><b>1.1.1</b> hello_world.html</a></li>
<li class="chapter" data-level="1.1.2" data-path="html.html"><a href="html.html#important-tags"><i class="fa fa-check"></i><b>1.1.2</b> Important tags</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="html.html"><a href="html.html#attribute"><i class="fa fa-check"></i><b>1.2</b> Attributes</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="html.html"><a href="html.html#links"><i class="fa fa-check"></i><b>1.2.1</b> Links</a></li>
<li class="chapter" data-level="1.2.2" data-path="html.html"><a href="html.html#images"><i class="fa fa-check"></i><b>1.2.2</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="html.html"><a href="html.html#entities"><i class="fa fa-check"></i><b>1.3</b> Entities</a></li>
</ul></li>
<li class="part"><span><b>II R Basics &amp; Tidyverse</b></span></li>
<li class="chapter" data-level="2" data-path="R1.html"><a href="R1.html"><i class="fa fa-check"></i><b>2</b> R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="R1.html"><a href="R1.html#installing-r"><i class="fa fa-check"></i><b>2.1</b> Installing R</a></li>
<li class="chapter" data-level="2.2" data-path="R1.html"><a href="R1.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="R1.html"><a href="R1.html#overview"><i class="fa fa-check"></i><b>2.2.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="R1.html"><a href="R1.html#hello-world"><i class="fa fa-check"></i><b>2.3</b> Hello World!</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="R1.html"><a href="R1.html#calculating-with-r"><i class="fa fa-check"></i><b>2.3.1</b> Calculating with R</a></li>
<li class="chapter" data-level="2.3.2" data-path="R1.html"><a href="R1.html#comparison-operators"><i class="fa fa-check"></i><b>2.3.2</b> Comparison operators</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="R1.html"><a href="R1.html#objects"><i class="fa fa-check"></i><b>2.4</b> Objects</a></li>
<li class="chapter" data-level="2.5" data-path="R1.html"><a href="R1.html#vectors"><i class="fa fa-check"></i><b>2.5</b> Vectors</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="R1.html"><a href="R1.html#subsetting"><i class="fa fa-check"></i><b>2.5.1</b> Subsetting</a></li>
<li class="chapter" data-level="2.5.2" data-path="R1.html"><a href="R1.html#types-of-vectors"><i class="fa fa-check"></i><b>2.5.2</b> Types of vectors</a></li>
<li class="chapter" data-level="2.5.3" data-path="R1.html"><a href="R1.html#a-brief-look-at-lists"><i class="fa fa-check"></i><b>2.5.3</b> A brief look at lists</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="R1.html"><a href="R1.html#functions"><i class="fa fa-check"></i><b>2.6</b> Functions</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="R1.html"><a href="R1.html#help"><i class="fa fa-check"></i><b>2.6.1</b> Help</a></li>
<li class="chapter" data-level="2.6.2" data-path="R1.html"><a href="R1.html#examples-basic-statistical-functions"><i class="fa fa-check"></i><b>2.6.2</b> Examples: Basic statistical functions</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="R1.html"><a href="R1.html#ifelse-statements"><i class="fa fa-check"></i><b>2.7</b> If/Else statements</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="R2.html"><a href="R2.html"><i class="fa fa-check"></i><b>3</b> RStudio in practice &amp; the tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="R2.html"><a href="R2.html#rstudio-workflow"><i class="fa fa-check"></i><b>3.1</b> RStudio Workflow</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="R2.html"><a href="R2.html#r-scripts"><i class="fa fa-check"></i><b>3.1.1</b> R Scripts</a></li>
<li class="chapter" data-level="3.1.2" data-path="R2.html"><a href="R2.html#projects"><i class="fa fa-check"></i><b>3.1.2</b> Projects</a></li>
<li class="chapter" data-level="3.1.3" data-path="R2.html"><a href="R2.html#comments"><i class="fa fa-check"></i><b>3.1.3</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="R2.html"><a href="R2.html#r-packages"><i class="fa fa-check"></i><b>3.2</b> R packages</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="R2.html"><a href="R2.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>3.2.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="3.2.2" data-path="R2.html"><a href="R2.html#namespaces"><i class="fa fa-check"></i><b>3.2.2</b> Namespaces</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="R2.html"><a href="R2.html#tidyverse"><i class="fa fa-check"></i><b>3.3</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="R2.html"><a href="R2.html#tibbles"><i class="fa fa-check"></i><b>3.3.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="R2.html"><a href="R2.html#additional-resources"><i class="fa fa-check"></i><b>3.4</b> Additional resources</a></li>
</ul></li>
<li class="part"><span><b>III Scraping</b></span></li>
<li class="chapter" data-level="4" data-path="rvest1.html"><a href="rvest1.html"><i class="fa fa-check"></i><b>4</b> First scraping with rvest</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rvest1.html"><a href="rvest1.html#the-rvest-package"><i class="fa fa-check"></i><b>4.1</b> The rvest package</a></li>
<li class="chapter" data-level="4.2" data-path="rvest1.html"><a href="rvest1.html#hello_world.html-1"><i class="fa fa-check"></i><b>4.2</b> hello_world.html</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rvest1.html"><a href="rvest1.html#read_html"><i class="fa fa-check"></i><b>4.2.1</b> read_html()</a></li>
<li class="chapter" data-level="4.2.2" data-path="rvest1.html"><a href="rvest1.html#html_nodes"><i class="fa fa-check"></i><b>4.2.2</b> html_nodes()</a></li>
<li class="chapter" data-level="4.2.3" data-path="rvest1.html"><a href="rvest1.html#html_text"><i class="fa fa-check"></i><b>4.2.3</b> html_text()</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rvest1.html"><a href="rvest1.html#countries-of-the-world"><i class="fa fa-check"></i><b>4.3</b> Countries of the World</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rvest1.html"><a href="rvest1.html#country-names"><i class="fa fa-check"></i><b>4.3.1</b> Country names</a></li>
<li class="chapter" data-level="4.3.2" data-path="rvest1.html"><a href="rvest1.html#capitals-population-and-area"><i class="fa fa-check"></i><b>4.3.2</b> Capitals, population and area</a></li>
<li class="chapter" data-level="4.3.3" data-path="rvest1.html"><a href="rvest1.html#merge-into-one-tibble"><i class="fa fa-check"></i><b>4.3.3</b> Merge into one tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html"><i class="fa fa-check"></i><b>5</b> CSS selectors &amp; Developer Tools</a>
<ul>
<li class="chapter" data-level="5.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#css"><i class="fa fa-check"></i><b>5.1</b> CSS selectors</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#classes"><i class="fa fa-check"></i><b>5.1.1</b> Classes</a></li>
<li class="chapter" data-level="5.1.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#ids"><i class="fa fa-check"></i><b>5.1.2</b> IDs</a></li>
<li class="chapter" data-level="5.1.3" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#attributes"><i class="fa fa-check"></i><b>5.1.3</b> Attributes</a></li>
<li class="chapter" data-level="5.1.4" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#hierarchy-levels"><i class="fa fa-check"></i><b>5.1.4</b> Hierarchy levels</a></li>
<li class="chapter" data-level="5.1.5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#further-selectors"><i class="fa fa-check"></i><b>5.1.5</b> Further selectors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#developer-tools"><i class="fa fa-check"></i><b>5.2</b> Developer Tools</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rvest2.html"><a href="rvest2.html"><i class="fa fa-check"></i><b>6</b> Scraping of tables &amp; dynamic websites</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rvest2.html"><a href="rvest2.html#scraping-of-tables"><i class="fa fa-check"></i><b>6.1</b> Scraping of tables</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rvest2.html"><a href="rvest2.html#table-with-css-selectors-from-wikipedia"><i class="fa fa-check"></i><b>6.1.1</b> Table with CSS selectors from Wikipedia</a></li>
<li class="chapter" data-level="6.1.2" data-path="rvest2.html"><a href="rvest2.html#scraping-multiple-tables"><i class="fa fa-check"></i><b>6.1.2</b> Scraping multiple tables</a></li>
<li class="chapter" data-level="6.1.3" data-path="rvest2.html"><a href="rvest2.html#tabellen-mit-nas"><i class="fa fa-check"></i><b>6.1.3</b> Tabellen mit NAs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rvest2.html"><a href="rvest2.html#dynamische-websites"><i class="fa fa-check"></i><b>6.2</b> Dynamische Websites</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rvest2.html"><a href="rvest2.html#html-forms-and-html-queries"><i class="fa fa-check"></i><b>6.2.1</b> HTML forms and HTML queries</a></li>
<li class="chapter" data-level="6.2.2" data-path="rvest2.html"><a href="rvest2.html#html-forms"><i class="fa fa-check"></i><b>6.2.2</b> HTML forms</a></li>
<li class="chapter" data-level="6.2.3" data-path="rvest2.html"><a href="rvest2.html#the-query"><i class="fa fa-check"></i><b>6.2.3</b> The query</a></li>
<li class="chapter" data-level="6.2.4" data-path="rvest2.html"><a href="rvest2.html#manipulating-the-query-and-scraping-the-result"><i class="fa fa-check"></i><b>6.2.4</b> Manipulating the query and scraping the result</a></li>
<li class="chapter" data-level="6.2.5" data-path="rvest2.html"><a href="rvest2.html#additional-resources-1"><i class="fa fa-check"></i><b>6.2.5</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rvest3.html"><a href="rvest3.html"><i class="fa fa-check"></i><b>7</b> Scraping of multi-page websites</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rvest3.html"><a href="rvest3.html#index-pages"><i class="fa fa-check"></i><b>7.1</b> Index-pages</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rvest3.html"><a href="rvest3.html#scraping-of-the-index"><i class="fa fa-check"></i><b>7.1.1</b> Scraping of the index</a></li>
<li class="chapter" data-level="7.1.2" data-path="rvest3.html"><a href="rvest3.html#iteration-with-map"><i class="fa fa-check"></i><b>7.1.2</b> Iteration with map()</a></li>
<li class="chapter" data-level="7.1.3" data-path="rvest3.html"><a href="rvest3.html#scraping-the-sub-pages"><i class="fa fa-check"></i><b>7.1.3</b> Scraping the sub-pages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rvest3.html"><a href="rvest3.html#pagination"><i class="fa fa-check"></i><b>7.2</b> Pagination</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rvest3.html"><a href="rvest3.html#the-query-1"><i class="fa fa-check"></i><b>7.2.1</b> The query</a></li>
<li class="chapter" data-level="7.2.2" data-path="rvest3.html"><a href="rvest3.html#sub-pgs"><i class="fa fa-check"></i><b>7.2.2</b> Scraping the sub-pages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>8</b> Downloading and saving files</a>
<ul>
<li class="chapter" data-level="8.1" data-path="files.html"><a href="files.html#csv-files"><i class="fa fa-check"></i><b>8.1</b> CSV files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="files.html"><a href="files.html#parsing-a-csv-file"><i class="fa fa-check"></i><b>8.1.1</b> Parsing a CSV file</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="files.html"><a href="files.html#downloading-files"><i class="fa fa-check"></i><b>8.2</b> Downloading files</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="files.html"><a href="files.html#parsing-the-csv-files"><i class="fa fa-check"></i><b>8.2.1</b> Parsing the csv files</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="files.html"><a href="files.html#saving-data-files"><i class="fa fa-check"></i><b>8.3</b> Saving data files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="good-practice.html"><a href="good-practice.html"><i class="fa fa-check"></i><b>9</b> Good practice</a>
<ul>
<li class="chapter" data-level="9.1" data-path="good-practice.html"><a href="good-practice.html#we-are-no-web-crawlers"><i class="fa fa-check"></i><b>9.1</b> We are no web crawlers</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="good-practice.html"><a href="good-practice.html#on-robots.txt-files"><i class="fa fa-check"></i><b>9.1.1</b> On robots.txt files</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="good-practice.html"><a href="good-practice.html#reduce-traffic"><i class="fa fa-check"></i><b>9.2</b> Reduce traffic</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="good-practice.html"><a href="good-practice.html#waiting-times-in-action"><i class="fa fa-check"></i><b>9.2.1</b> Waiting times in action</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Data analysis</b></span></li>
<li class="chapter" data-level="10" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>10</b> Transformation with dplyr</a>
<ul>
<li class="chapter" data-level="10.1" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>10.1</b> <code>filter()</code></a></li>
<li class="chapter" data-level="10.2" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>10.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="10.3" data-path="dplyr.html"><a href="dplyr.html#rename"><i class="fa fa-check"></i><b>10.3</b> <code>rename()</code></a></li>
<li class="chapter" data-level="10.4" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>10.4</b> <code>mutate()</code></a></li>
<li class="chapter" data-level="10.5" data-path="dplyr.html"><a href="dplyr.html#summarise-group_by"><i class="fa fa-check"></i><b>10.5</b> <code>summarise()</code> &amp; <code>group_by()</code></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>11</b> Graphical analysis with ggplot</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ggplot.html"><a href="ggplot.html#ggplot-syntax"><i class="fa fa-check"></i><b>11.1</b> ggplot syntax</a></li>
<li class="chapter" data-level="11.2" data-path="ggplot.html"><a href="ggplot.html#aesthtetics"><i class="fa fa-check"></i><b>11.2</b> Aesthtetics</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="ggplot.html"><a href="ggplot.html#continuous"><i class="fa fa-check"></i><b>11.2.1</b> Continuous</a></li>
<li class="chapter" data-level="11.2.2" data-path="ggplot.html"><a href="ggplot.html#continuous-x-continuous"><i class="fa fa-check"></i><b>11.2.2</b> Continuous x Continuous</a></li>
<li class="chapter" data-level="11.2.3" data-path="ggplot.html"><a href="ggplot.html#discrete-x-continuous"><i class="fa fa-check"></i><b>11.2.3</b> Discrete x Continuous</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="ggplot.html"><a href="ggplot.html#tuning-the-output"><i class="fa fa-check"></i><b>11.3</b> Tuning the output</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>12</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="regex.html"><a href="regex.html#str_detect"><i class="fa fa-check"></i><b>12.1</b> str_detect()</a></li>
<li class="chapter" data-level="12.2" data-path="regex.html"><a href="regex.html#basic-pattern-matching"><i class="fa fa-check"></i><b>12.2</b> Basic pattern matching</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="regex.html"><a href="regex.html#literal-characters"><i class="fa fa-check"></i><b>12.2.1</b> Literal characters</a></li>
<li class="chapter" data-level="12.2.2" data-path="regex.html"><a href="regex.html#escaping-metacharacters"><i class="fa fa-check"></i><b>12.2.2</b> Escaping metacharacters</a></li>
<li class="chapter" data-level="12.2.3" data-path="regex.html"><a href="regex.html#character-classes"><i class="fa fa-check"></i><b>12.2.3</b> Character classes</a></li>
<li class="chapter" data-level="12.2.4" data-path="regex.html"><a href="regex.html#anchors"><i class="fa fa-check"></i><b>12.2.4</b> Anchors</a></li>
<li class="chapter" data-level="12.2.5" data-path="regex.html"><a href="regex.html#quantifiers"><i class="fa fa-check"></i><b>12.2.5</b> Quantifiers</a></li>
<li class="chapter" data-level="12.2.6" data-path="regex.html"><a href="regex.html#groups"><i class="fa fa-check"></i><b>12.2.6</b> Groups</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="regex.html"><a href="regex.html#practical-application"><i class="fa fa-check"></i><b>12.3</b> Practical application</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="regex.html"><a href="regex.html#str_count"><i class="fa fa-check"></i><b>12.3.1</b> str_count()</a></li>
<li class="chapter" data-level="12.3.2" data-path="regex.html"><a href="regex.html#str_extract-str_match"><i class="fa fa-check"></i><b>12.3.2</b> str_extract() &amp; str_match()</a></li>
<li class="chapter" data-level="12.3.3" data-path="regex.html"><a href="regex.html#str_replace"><i class="fa fa-check"></i><b>12.3.3</b> str_replace()</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Transformation with dplyr</h1>
<p>WIP! Content is due to change!</p>
<p>At this point you should have a look at both tibbles either by clicking on them
in the environment tab or by writing <code>View(eligible_tbl)</code> and
<code>View(turnout_tbl)</code>.</p>
<p>A quick sidenote: You will notice, that most of the values we will compute in
this chapter are already present in eligible.csv. We will soon drop those and
compute them ourselves for the sake of having a good introductory example into
data transformation. In a real world scenario we would most probably just use
the values for turnout percentages etc. already present in the data.</p>
<p>In the following, we will use several functions from the tidyverse package
dplyr to filter observations, select columns and add new columns as
computations of existing ones.</p>
<div id="filter" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> <code>filter()</code></h2>
<p>As a first step, we should limit our tibbles to the observations we actually
need. For this example we should limit ourselves to an analysis on the federal
level. Thus we can drop all observations referring to the individual states. We
will also drop the totals for the gender and year of birth columns and compute
them ourselves later on.</p>
<p>To filter on the observations we need and drop the remainder, we can use the
function <code>filter()</code>. It takes the tibble or data frame to be filtered as it’s
first argument – which we don’t need to specify when using the pipe – and one
or multiple expressions that specify which observations are to be filtered.</p>
<p>To filter only those observations that have the value “Bund” for the column
“Land”, we can write:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="dplyr.html#cb175-1" aria-hidden="true" tabindex="-1"></a>eligible_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb175-2"><a href="dplyr.html#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(Land <span class="sc">==</span> <span class="st">&quot;Bund&quot;</span>)</span>
<span id="cb175-3"><a href="dplyr.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 33 x 10</span></span>
<span id="cb175-4"><a href="dplyr.html#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Land  Geschlecht Geburtsjahresgr… Wahlberechtigte `Wahlberechtigt…</span></span>
<span id="cb175-5"><a href="dplyr.html#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;                      &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb175-6"><a href="dplyr.html#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Bund  Summe      Summe                   61688485         47595800</span></span>
<span id="cb175-7"><a href="dplyr.html#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Bund  Summe      1997 - 1999              2045501          1709333</span></span>
<span id="cb175-8"><a href="dplyr.html#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Bund  Summe      1993 - 1996              2902998          2295723</span></span>
<span id="cb175-9"><a href="dplyr.html#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Bund  Summe      1988 - 1992              4206014          3311417</span></span>
<span id="cb175-10"><a href="dplyr.html#cb175-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Bund  Summe      1983 - 1987              4302277          3455795</span></span>
<span id="cb175-11"><a href="dplyr.html#cb175-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Bund  Summe      1978 - 1982              4264347          3490155</span></span>
<span id="cb175-12"><a href="dplyr.html#cb175-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Bund  Summe      1973 - 1977              3953481          3273575</span></span>
<span id="cb175-13"><a href="dplyr.html#cb175-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Bund  Summe      1968 - 1972              5230865          4232089</span></span>
<span id="cb175-14"><a href="dplyr.html#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Bund  Summe      1958 - 1967             12396299          9581842</span></span>
<span id="cb175-15"><a href="dplyr.html#cb175-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Bund  Summe      1948 - 1957              9487267          6950185</span></span>
<span id="cb175-16"><a href="dplyr.html#cb175-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 23 more rows, and 5 more variables: `Wahlberechtigte mit</span></span>
<span id="cb175-17"><a href="dplyr.html#cb175-17" aria-hidden="true" tabindex="-1"></a><span class="do">## #   Wahlscheinvermerk` &lt;dbl&gt;, `Wähler/-innen` &lt;dbl&gt;, `Wähler/-innen ohne</span></span>
<span id="cb175-18"><a href="dplyr.html#cb175-18" aria-hidden="true" tabindex="-1"></a><span class="do">## #   Wahlschein` &lt;dbl&gt;, `Wähler/-innen mit Wahlschein` &lt;dbl&gt;,</span></span>
<span id="cb175-19"><a href="dplyr.html#cb175-19" aria-hidden="true" tabindex="-1"></a><span class="do">## #   Wahlbeteiligung &lt;dbl&gt;</span></span></code></pre></div>
<p>Thus only the observations for “Bund” remain in the tibble. Or in other words,
those observations for whom the expression <code>Land == "Bund"</code> is returned as
<code>TRUE</code>. Besides <code>==</code>, all other comparison operators can be used and we can
chain multiple expressions to be filtered upon in one call of <code>filter()</code>. So, to
filter on those observations who refer to the “Bund” and don’t have a sum for
the gender and year of birth columns, we can write:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="dplyr.html#cb176-1" aria-hidden="true" tabindex="-1"></a>eligible_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb176-2"><a href="dplyr.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Land <span class="sc">==</span> <span class="st">&quot;Bund&quot;</span>, Geschlecht <span class="sc">!=</span> <span class="st">&quot;Summe&quot;</span>, Geburtsjahresgruppe <span class="sc">!=</span> <span class="st">&quot;Summe&quot;</span>)</span>
<span id="cb176-3"><a href="dplyr.html#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 20 x 10</span></span>
<span id="cb176-4"><a href="dplyr.html#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Land  Geschlecht Geburtsjahresgr… Wahlberechtigte `Wahlberechtigt…</span></span>
<span id="cb176-5"><a href="dplyr.html#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;                      &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb176-6"><a href="dplyr.html#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Bund  m          1997 - 1999              1046360           893024</span></span>
<span id="cb176-7"><a href="dplyr.html#cb176-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Bund  m          1993 - 1996              1479600          1210140</span></span>
<span id="cb176-8"><a href="dplyr.html#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Bund  m          1988 - 1992              2143419          1725440</span></span>
<span id="cb176-9"><a href="dplyr.html#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Bund  m          1983 - 1987              2185551          1777746</span></span>
<span id="cb176-10"><a href="dplyr.html#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Bund  m          1978 - 1982              2147986          1772715</span></span>
<span id="cb176-11"><a href="dplyr.html#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Bund  m          1973 - 1977              1990144          1655475</span></span>
<span id="cb176-12"><a href="dplyr.html#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Bund  m          1968 - 1972              2630344          2157384</span></span>
<span id="cb176-13"><a href="dplyr.html#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Bund  m          1958 - 1967              6205978          4896721</span></span>
<span id="cb176-14"><a href="dplyr.html#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Bund  m          1948 - 1957              4602052          3418179</span></span>
<span id="cb176-15"><a href="dplyr.html#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Bund  m          1947 und früher          5381355          3865963</span></span>
<span id="cb176-16"><a href="dplyr.html#cb176-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Bund  w          1997 - 1999               999140           816309</span></span>
<span id="cb176-17"><a href="dplyr.html#cb176-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Bund  w          1993 - 1996              1423399          1085584</span></span>
<span id="cb176-18"><a href="dplyr.html#cb176-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 Bund  w          1988 - 1992              2062596          1585978</span></span>
<span id="cb176-19"><a href="dplyr.html#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 Bund  w          1983 - 1987              2116726          1678049</span></span>
<span id="cb176-20"><a href="dplyr.html#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 Bund  w          1978 - 1982              2116362          1717440</span></span>
<span id="cb176-21"><a href="dplyr.html#cb176-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 Bund  w          1973 - 1977              1963337          1618100</span></span>
<span id="cb176-22"><a href="dplyr.html#cb176-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 17 Bund  w          1968 - 1972              2600522          2074705</span></span>
<span id="cb176-23"><a href="dplyr.html#cb176-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 18 Bund  w          1958 - 1967              6190321          4685122</span></span>
<span id="cb176-24"><a href="dplyr.html#cb176-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 19 Bund  w          1948 - 1957              4885215          3532006</span></span>
<span id="cb176-25"><a href="dplyr.html#cb176-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 20 Bund  w          1947 und früher          7518080          5429723</span></span>
<span id="cb176-26"><a href="dplyr.html#cb176-26" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 5 more variables: `Wahlberechtigte mit Wahlscheinvermerk` &lt;dbl&gt;,</span></span>
<span id="cb176-27"><a href="dplyr.html#cb176-27" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `Wähler/-innen` &lt;dbl&gt;, `Wähler/-innen ohne Wahlschein` &lt;dbl&gt;,</span></span>
<span id="cb176-28"><a href="dplyr.html#cb176-28" aria-hidden="true" tabindex="-1"></a><span class="do">## #   `Wähler/-innen mit Wahlschein` &lt;dbl&gt;, Wahlbeteiligung &lt;dbl&gt;</span></span></code></pre></div>
<p>We can also use logical operators – <code>&amp;</code> for “and”, <code>|</code> for “or” – when
combining expressions to be filtered upon. So instead of <code>Geschlecht = "Summe"</code>
another approach would be to filter those that have “m” or “w” as values. To
demonstrate this, let us filter the object <code>turnout_tbl</code>as well. Here we have an
additional column we have to filter for called “Erst-/Zweitstimme”. I propose
we only analyse the party votes.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="dplyr.html#cb177-1" aria-hidden="true" tabindex="-1"></a>turnout_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="dplyr.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Land <span class="sc">==</span> <span class="st">&quot;Bund&quot;</span>,</span>
<span id="cb177-3"><a href="dplyr.html#cb177-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Erst-/Zweitstimme</span><span class="st">`</span> <span class="sc">==</span> <span class="dv">2</span>,</span>
<span id="cb177-4"><a href="dplyr.html#cb177-4" aria-hidden="true" tabindex="-1"></a>         Geschlecht <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">|</span> Geschlecht <span class="sc">==</span> <span class="st">&quot;w&quot;</span>,</span>
<span id="cb177-5"><a href="dplyr.html#cb177-5" aria-hidden="true" tabindex="-1"></a>         Geburtsjahresgruppe <span class="sc">!=</span> <span class="st">&quot;Summe&quot;</span>)</span>
<span id="cb177-6"><a href="dplyr.html#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 16</span></span>
<span id="cb177-7"><a href="dplyr.html#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    Land  `Erst-/Zweitsti… Geschlecht Geburtsjahresgr…  Summe Ungültig    CDU</span></span>
<span id="cb177-8"><a href="dplyr.html#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;             &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb177-9"><a href="dplyr.html#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Bund                 2 m          1993 - 1999      1.69e6    13189 3.00e5</span></span>
<span id="cb177-10"><a href="dplyr.html#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Bund                 2 m          1983 - 1992      3.00e6    19674 5.55e5</span></span>
<span id="cb177-11"><a href="dplyr.html#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Bund                 2 m          1973 - 1982      3.09e6    19901 6.66e5</span></span>
<span id="cb177-12"><a href="dplyr.html#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Bund                 2 m          1958 - 1972      6.93e6    47053 1.54e6</span></span>
<span id="cb177-13"><a href="dplyr.html#cb177-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Bund                 2 m          1948 - 1957      3.74e6    34896 8.75e5</span></span>
<span id="cb177-14"><a href="dplyr.html#cb177-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Bund                 2 m          1947 und früher  4.30e6    65480 1.36e6</span></span>
<span id="cb177-15"><a href="dplyr.html#cb177-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Bund                 2 w          1993 - 1999      1.67e6    11114 3.65e5</span></span>
<span id="cb177-16"><a href="dplyr.html#cb177-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Bund                 2 w          1983 - 1992      3.04e6    20091 7.31e5</span></span>
<span id="cb177-17"><a href="dplyr.html#cb177-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Bund                 2 w          1973 - 1982      3.14e6    22593 8.53e5</span></span>
<span id="cb177-18"><a href="dplyr.html#cb177-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Bund                 2 w          1958 - 1972      6.99e6    56535 1.89e6</span></span>
<span id="cb177-19"><a href="dplyr.html#cb177-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Bund                 2 w          1948 - 1957      3.95e6    45878 1.19e6</span></span>
<span id="cb177-20"><a href="dplyr.html#cb177-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Bund                 2 w          1947 und früher  5.43e6   104446 2.12e6</span></span>
<span id="cb177-21"><a href="dplyr.html#cb177-21" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 9 more variables: SPD &lt;dbl&gt;, `DIE LINKE` &lt;dbl&gt;, GRÜNE &lt;dbl&gt;,</span></span>
<span id="cb177-22"><a href="dplyr.html#cb177-22" aria-hidden="true" tabindex="-1"></a><span class="do">## #   CSU &lt;dbl&gt;, FDP &lt;dbl&gt;, AfD &lt;dbl&gt;, Sonstige &lt;dbl&gt;, `dar. NPD` &lt;dbl&gt;, `dar.</span></span>
<span id="cb177-23"><a href="dplyr.html#cb177-23" aria-hidden="true" tabindex="-1"></a><span class="do">## #   FREIE WÄHLER` &lt;dbl&gt;</span></span></code></pre></div>
<p>When we create rather long function calls with many arguments, it is often a
good idea to insert some line breaks to keep your code easily readable, as seen
above.</p>
<p>Let’s have another look at this line: <code>`Erst-/Zweitstimme` == 2,</code>. You will
notice, that the name of the column is enclosed by <em>backticks</em> <code>`</code>. In
general, object and variable (ie. column) names in R can only contain letters,
numbers, points and underscores and have to start with a letter. It is possible
to have names that violate those rules, but these have to enclosed in backticks.
As you can see, “Erst-/Zweitstimme” contains two characters that are not allowed
in R names. <code>turnout_tbl</code> also contains the column “DIE LINKE”. The usage of
whitespace in names is also not allowed. So to address this column in our code,
we would have to write <code></code>DIE LINKE<code></code>.</p>
</div>
<div id="select" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> <code>select()</code></h2>
<p>We should also limit our tibbles to the set of columns we will actually use.</p>
<p>Looking at <code>eligible_tbl</code>, we will only need the first four columns. We can use
the function <code>select()</code> to “select” the columns we need by name.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="dplyr.html#cb178-1" aria-hidden="true" tabindex="-1"></a>eligible_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb178-2"><a href="dplyr.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Land, Geschlecht, Geburtsjahresgruppe, Wahlberechtigte)</span>
<span id="cb178-3"><a href="dplyr.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 627 x 4</span></span>
<span id="cb178-4"><a href="dplyr.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Land  Geschlecht Geburtsjahresgruppe Wahlberechtigte</span></span>
<span id="cb178-5"><a href="dplyr.html#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;                         &lt;dbl&gt;</span></span>
<span id="cb178-6"><a href="dplyr.html#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Bund  Summe      Summe                      61688485</span></span>
<span id="cb178-7"><a href="dplyr.html#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Bund  Summe      1997 - 1999                 2045501</span></span>
<span id="cb178-8"><a href="dplyr.html#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Bund  Summe      1993 - 1996                 2902998</span></span>
<span id="cb178-9"><a href="dplyr.html#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Bund  Summe      1988 - 1992                 4206014</span></span>
<span id="cb178-10"><a href="dplyr.html#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Bund  Summe      1983 - 1987                 4302277</span></span>
<span id="cb178-11"><a href="dplyr.html#cb178-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Bund  Summe      1978 - 1982                 4264347</span></span>
<span id="cb178-12"><a href="dplyr.html#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Bund  Summe      1973 - 1977                 3953481</span></span>
<span id="cb178-13"><a href="dplyr.html#cb178-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Bund  Summe      1968 - 1972                 5230865</span></span>
<span id="cb178-14"><a href="dplyr.html#cb178-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Bund  Summe      1958 - 1967                12396299</span></span>
<span id="cb178-15"><a href="dplyr.html#cb178-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Bund  Summe      1948 - 1957                 9487267</span></span>
<span id="cb178-16"><a href="dplyr.html#cb178-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 617 more rows</span></span></code></pre></div>
<p>If, as in this case, the columns we want so select follow each other in their
positions in the tibble, we can also use a shorter “from:to” notation, that
saves us somy typing.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="dplyr.html#cb179-1" aria-hidden="true" tabindex="-1"></a>eligible_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="dplyr.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Land<span class="sc">:</span>Wahlberechtigte)</span>
<span id="cb179-3"><a href="dplyr.html#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 627 x 4</span></span>
<span id="cb179-4"><a href="dplyr.html#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    Land  Geschlecht Geburtsjahresgruppe Wahlberechtigte</span></span>
<span id="cb179-5"><a href="dplyr.html#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;                         &lt;dbl&gt;</span></span>
<span id="cb179-6"><a href="dplyr.html#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Bund  Summe      Summe                      61688485</span></span>
<span id="cb179-7"><a href="dplyr.html#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Bund  Summe      1997 - 1999                 2045501</span></span>
<span id="cb179-8"><a href="dplyr.html#cb179-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Bund  Summe      1993 - 1996                 2902998</span></span>
<span id="cb179-9"><a href="dplyr.html#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Bund  Summe      1988 - 1992                 4206014</span></span>
<span id="cb179-10"><a href="dplyr.html#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Bund  Summe      1983 - 1987                 4302277</span></span>
<span id="cb179-11"><a href="dplyr.html#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Bund  Summe      1978 - 1982                 4264347</span></span>
<span id="cb179-12"><a href="dplyr.html#cb179-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Bund  Summe      1973 - 1977                 3953481</span></span>
<span id="cb179-13"><a href="dplyr.html#cb179-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Bund  Summe      1968 - 1972                 5230865</span></span>
<span id="cb179-14"><a href="dplyr.html#cb179-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Bund  Summe      1958 - 1967                12396299</span></span>
<span id="cb179-15"><a href="dplyr.html#cb179-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Bund  Summe      1948 - 1957                 9487267</span></span>
<span id="cb179-16"><a href="dplyr.html#cb179-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 617 more rows</span></span></code></pre></div>
<p>At this point we can combine the filtering of rows and selection of columns in
the pipe and assign the result to a new object. But first, let us think about
again about which columns we will actually need. Above we selected the first
four columns from <code>turnout_tbl</code>. But we do not actually need the column “Land”
after we filtered for the rows containing the federal state level as it contains
no useful information anymore. So we can drop the column, if we filter first.
Order matters! For <code>turnout_tbl</code> this is also true but extends to the column
“Erst-/Zweitstimme” which also only contains one value after filtering.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="dplyr.html#cb180-1" aria-hidden="true" tabindex="-1"></a>eligible_tbl <span class="ot">&lt;-</span> eligible_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb180-2"><a href="dplyr.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Land <span class="sc">==</span> <span class="st">&quot;Bund&quot;</span>, </span>
<span id="cb180-3"><a href="dplyr.html#cb180-3" aria-hidden="true" tabindex="-1"></a>         Geschlecht <span class="sc">!=</span> <span class="st">&quot;Summe&quot;</span>,</span>
<span id="cb180-4"><a href="dplyr.html#cb180-4" aria-hidden="true" tabindex="-1"></a>         Geburtsjahresgruppe <span class="sc">!=</span> <span class="st">&quot;Summe&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb180-5"><a href="dplyr.html#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geschlecht<span class="sc">:</span>Wahlberechtigte)</span>
<span id="cb180-6"><a href="dplyr.html#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="dplyr.html#cb180-7" aria-hidden="true" tabindex="-1"></a>turnout_tbl <span class="ot">&lt;-</span> turnout_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb180-8"><a href="dplyr.html#cb180-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Land <span class="sc">==</span> <span class="st">&quot;Bund&quot;</span>,</span>
<span id="cb180-9"><a href="dplyr.html#cb180-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Erst-/Zweitstimme</span><span class="st">`</span> <span class="sc">==</span> <span class="dv">2</span>,</span>
<span id="cb180-10"><a href="dplyr.html#cb180-10" aria-hidden="true" tabindex="-1"></a>         Geschlecht <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">|</span> Geschlecht <span class="sc">==</span> <span class="st">&quot;w&quot;</span>,</span>
<span id="cb180-11"><a href="dplyr.html#cb180-11" aria-hidden="true" tabindex="-1"></a>         Geburtsjahresgruppe <span class="sc">!=</span> <span class="st">&quot;Summe&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb180-12"><a href="dplyr.html#cb180-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geschlecht<span class="sc">:</span>Summe)</span></code></pre></div>
</div>
<div id="rename" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> <code>rename()</code></h2>
<p>As we are working in english, it makes sense to also rename the columns using
english wordings. Also, we have to write down the column names several time
during analysis, so we should use names that are short but concise to limit
unnecessary typing while maintaining recognisability. Imagine writing
“Geburtsjahresgruppe” several times in your code, and you will know why
renaming is approriate here. Also the column “Summe” in <code>turnout_tbl</code> does not
describe what the values stored in it refer to. We should change this.</p>
<p>One approach to renaming is using the function <code>rename()</code> from dplyr. The
function takes the data to applied to as its first argument – passed by the
pipe in this case – followed by one or more arguments in the form
<code>new_name = old_name</code>.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="dplyr.html#cb181-1" aria-hidden="true" tabindex="-1"></a>eligible_tbl <span class="ot">&lt;-</span> eligible_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="dplyr.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> Geschlecht,</span>
<span id="cb181-3"><a href="dplyr.html#cb181-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ybirth =</span> Geburtsjahresgruppe,</span>
<span id="cb181-4"><a href="dplyr.html#cb181-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">eligible =</span> Wahlberechtigte)</span>
<span id="cb181-5"><a href="dplyr.html#cb181-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-6"><a href="dplyr.html#cb181-6" aria-hidden="true" tabindex="-1"></a>eligible_tbl</span>
<span id="cb181-7"><a href="dplyr.html#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 20 x 3</span></span>
<span id="cb181-8"><a href="dplyr.html#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    gender ybirth          eligible</span></span>
<span id="cb181-9"><a href="dplyr.html#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;</span></span>
<span id="cb181-10"><a href="dplyr.html#cb181-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 m      1997 - 1999      1046360</span></span>
<span id="cb181-11"><a href="dplyr.html#cb181-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 m      1993 - 1996      1479600</span></span>
<span id="cb181-12"><a href="dplyr.html#cb181-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 m      1988 - 1992      2143419</span></span>
<span id="cb181-13"><a href="dplyr.html#cb181-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 m      1983 - 1987      2185551</span></span>
<span id="cb181-14"><a href="dplyr.html#cb181-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 m      1978 - 1982      2147986</span></span>
<span id="cb181-15"><a href="dplyr.html#cb181-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 m      1973 - 1977      1990144</span></span>
<span id="cb181-16"><a href="dplyr.html#cb181-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 m      1968 - 1972      2630344</span></span>
<span id="cb181-17"><a href="dplyr.html#cb181-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 m      1958 - 1967      6205978</span></span>
<span id="cb181-18"><a href="dplyr.html#cb181-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 m      1948 - 1957      4602052</span></span>
<span id="cb181-19"><a href="dplyr.html#cb181-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 m      1947 und früher  5381355</span></span>
<span id="cb181-20"><a href="dplyr.html#cb181-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 w      1997 - 1999       999140</span></span>
<span id="cb181-21"><a href="dplyr.html#cb181-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 w      1993 - 1996      1423399</span></span>
<span id="cb181-22"><a href="dplyr.html#cb181-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 w      1988 - 1992      2062596</span></span>
<span id="cb181-23"><a href="dplyr.html#cb181-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 w      1983 - 1987      2116726</span></span>
<span id="cb181-24"><a href="dplyr.html#cb181-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 w      1978 - 1982      2116362</span></span>
<span id="cb181-25"><a href="dplyr.html#cb181-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 w      1973 - 1977      1963337</span></span>
<span id="cb181-26"><a href="dplyr.html#cb181-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 17 w      1968 - 1972      2600522</span></span>
<span id="cb181-27"><a href="dplyr.html#cb181-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 18 w      1958 - 1967      6190321</span></span>
<span id="cb181-28"><a href="dplyr.html#cb181-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 19 w      1948 - 1957      4885215</span></span>
<span id="cb181-29"><a href="dplyr.html#cb181-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 20 w      1947 und früher  7518080</span></span>
<span id="cb181-30"><a href="dplyr.html#cb181-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-31"><a href="dplyr.html#cb181-31" aria-hidden="true" tabindex="-1"></a>turnout_tbl <span class="ot">&lt;-</span> turnout_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb181-32"><a href="dplyr.html#cb181-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> Geschlecht,</span>
<span id="cb181-33"><a href="dplyr.html#cb181-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">ybirth =</span> Geburtsjahresgruppe,</span>
<span id="cb181-34"><a href="dplyr.html#cb181-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">turnout =</span> Summe)</span>
<span id="cb181-35"><a href="dplyr.html#cb181-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-36"><a href="dplyr.html#cb181-36" aria-hidden="true" tabindex="-1"></a>turnout_tbl</span>
<span id="cb181-37"><a href="dplyr.html#cb181-37" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 3</span></span>
<span id="cb181-38"><a href="dplyr.html#cb181-38" aria-hidden="true" tabindex="-1"></a><span class="do">##    gender ybirth          turnout</span></span>
<span id="cb181-39"><a href="dplyr.html#cb181-39" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span id="cb181-40"><a href="dplyr.html#cb181-40" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 m      1993 - 1999     1694779</span></span>
<span id="cb181-41"><a href="dplyr.html#cb181-41" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 m      1983 - 1992     3001418</span></span>
<span id="cb181-42"><a href="dplyr.html#cb181-42" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 m      1973 - 1982     3089525</span></span>
<span id="cb181-43"><a href="dplyr.html#cb181-43" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 m      1958 - 1972     6930258</span></span>
<span id="cb181-44"><a href="dplyr.html#cb181-44" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 m      1948 - 1957     3741274</span></span>
<span id="cb181-45"><a href="dplyr.html#cb181-45" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 m      1947 und früher 4300726</span></span>
<span id="cb181-46"><a href="dplyr.html#cb181-46" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 w      1993 - 1999     1674861</span></span>
<span id="cb181-47"><a href="dplyr.html#cb181-47" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 w      1983 - 1992     3038245</span></span>
<span id="cb181-48"><a href="dplyr.html#cb181-48" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 w      1973 - 1982     3137743</span></span>
<span id="cb181-49"><a href="dplyr.html#cb181-49" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 w      1958 - 1972     6987768</span></span>
<span id="cb181-50"><a href="dplyr.html#cb181-50" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 w      1948 - 1957     3951857</span></span>
<span id="cb181-51"><a href="dplyr.html#cb181-51" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 w      1947 und früher 5427886</span></span></code></pre></div>
</div>
<div id="mutate" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> <code>mutate()</code></h2>
<p>We will now leave our running example for a short time and look at how to
compute new variables in a tibble from existing ones, using <code>mutate()</code> from
dplyr.</p>
<p>For this purpose, let us create a new simple tibble on voter turnout. Note that
the entered data is purely illustrational and has no meaning. We will return to
the real data shortly.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="dplyr.html#cb182-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb182-2"><a href="dplyr.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;w&quot;</span>, <span class="st">&quot;w&quot;</span>),</span>
<span id="cb182-3"><a href="dplyr.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ybirth =</span> <span class="fu">c</span>(<span class="st">&quot;1993 - 1999&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>, <span class="st">&quot;1993 - 1999&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>),</span>
<span id="cb182-4"><a href="dplyr.html#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">eligible =</span> <span class="fu">c</span>(<span class="dv">100000</span>, <span class="dv">100000</span>, <span class="dv">100000</span>, <span class="dv">100000</span>),</span>
<span id="cb182-5"><a href="dplyr.html#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">turnout_person =</span> <span class="fu">c</span>(<span class="dv">40000</span>, <span class="dv">50000</span>, <span class="dv">60000</span>, <span class="dv">70000</span>),</span>
<span id="cb182-6"><a href="dplyr.html#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">turnout_mail =</span> <span class="fu">c</span> (<span class="dv">35000</span>, <span class="dv">30000</span>, <span class="dv">25000</span>, <span class="dv">20000</span>)</span>
<span id="cb182-7"><a href="dplyr.html#cb182-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb182-8"><a href="dplyr.html#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="dplyr.html#cb182-9" aria-hidden="true" tabindex="-1"></a>exmpl_tbl</span>
<span id="cb182-10"><a href="dplyr.html#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 5</span></span>
<span id="cb182-11"><a href="dplyr.html#cb182-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   gender ybirth      eligible turnout_person turnout_mail</span></span>
<span id="cb182-12"><a href="dplyr.html#cb182-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb182-13"><a href="dplyr.html#cb182-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 m      1993 - 1999   100000          40000        35000</span></span>
<span id="cb182-14"><a href="dplyr.html#cb182-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 m      1983 - 1992   100000          50000        30000</span></span>
<span id="cb182-15"><a href="dplyr.html#cb182-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 w      1993 - 1999   100000          60000        25000</span></span>
<span id="cb182-16"><a href="dplyr.html#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 w      1983 - 1992   100000          70000        20000</span></span></code></pre></div>
<p>In this hypothetical data, we have different columns for people who voted in
person and who voted by mail. We do not care about this difference in voting
method in this example and want one column that combines both. We can achieve
this by using <code>mutate()</code>. The function takes the data to be manipulated as its
first argument, followed by one or multiple arguments defining the new columns
to be created. We can create this new columns as computations involving the
columns already present. To calculate the total turnout we could write:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="dplyr.html#cb183-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb183-2"><a href="dplyr.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">turnout =</span> turnout_person <span class="sc">+</span> turnout_mail)</span>
<span id="cb183-3"><a href="dplyr.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 6</span></span>
<span id="cb183-4"><a href="dplyr.html#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   gender ybirth      eligible turnout_person turnout_mail turnout</span></span>
<span id="cb183-5"><a href="dplyr.html#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb183-6"><a href="dplyr.html#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 m      1993 - 1999   100000          40000        35000   75000</span></span>
<span id="cb183-7"><a href="dplyr.html#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 m      1983 - 1992   100000          50000        30000   80000</span></span>
<span id="cb183-8"><a href="dplyr.html#cb183-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 w      1993 - 1999   100000          60000        25000   85000</span></span>
<span id="cb183-9"><a href="dplyr.html#cb183-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 w      1983 - 1992   100000          70000        20000   90000</span></span></code></pre></div>
<p>We can also immediately start calculating with new columns in the same pipe. So
to calculate the turnout percentage:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="dplyr.html#cb184-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb184-2"><a href="dplyr.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb184-3"><a href="dplyr.html#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">turnout =</span> turnout_person <span class="sc">+</span> turnout_mail,</span>
<span id="cb184-4"><a href="dplyr.html#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">turnout_pct =</span> turnout <span class="sc">/</span> eligible</span>
<span id="cb184-5"><a href="dplyr.html#cb184-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb184-6"><a href="dplyr.html#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 7</span></span>
<span id="cb184-7"><a href="dplyr.html#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   gender ybirth      eligible turnout_person turnout_mail turnout turnout_pct</span></span>
<span id="cb184-8"><a href="dplyr.html#cb184-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb184-9"><a href="dplyr.html#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 m      1993 - 1999   100000          40000        35000   75000        0.75</span></span>
<span id="cb184-10"><a href="dplyr.html#cb184-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 m      1983 - 1992   100000          50000        30000   80000        0.8 </span></span>
<span id="cb184-11"><a href="dplyr.html#cb184-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 w      1993 - 1999   100000          60000        25000   85000        0.85</span></span>
<span id="cb184-12"><a href="dplyr.html#cb184-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 w      1983 - 1992   100000          70000        20000   90000        0.9</span></span></code></pre></div>
<p>As we no longer need <code>turnout_person</code> and <code>turnout_mail</code> we could drop them by
using <code>select()</code> in a last step. Instead of telling <code>select()</code> which columns we
want to keep, we can also tell it which noot to keep by adding a <code>-</code> before the
column names.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="dplyr.html#cb185-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="ot">&lt;-</span> exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb185-2"><a href="dplyr.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb185-3"><a href="dplyr.html#cb185-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout =</span> turnout_person <span class="sc">+</span> turnout_mail,</span>
<span id="cb185-4"><a href="dplyr.html#cb185-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_pct =</span> turnout <span class="sc">/</span> eligible</span>
<span id="cb185-5"><a href="dplyr.html#cb185-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb185-6"><a href="dplyr.html#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>turnout_person, <span class="sc">-</span>turnout_mail)</span>
<span id="cb185-7"><a href="dplyr.html#cb185-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-8"><a href="dplyr.html#cb185-8" aria-hidden="true" tabindex="-1"></a>exmpl_tbl</span>
<span id="cb185-9"><a href="dplyr.html#cb185-9" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 5</span></span>
<span id="cb185-10"><a href="dplyr.html#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   gender ybirth      eligible turnout turnout_pct</span></span>
<span id="cb185-11"><a href="dplyr.html#cb185-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb185-12"><a href="dplyr.html#cb185-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 m      1993 - 1999   100000   75000        0.75</span></span>
<span id="cb185-13"><a href="dplyr.html#cb185-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 m      1983 - 1992   100000   80000        0.8 </span></span>
<span id="cb185-14"><a href="dplyr.html#cb185-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 w      1993 - 1999   100000   85000        0.85</span></span>
<span id="cb185-15"><a href="dplyr.html#cb185-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 w      1983 - 1992   100000   90000        0.9</span></span></code></pre></div>
<p>Note that <code>mutate()</code> is not limited to basic arithmetic operations. Many
functions can be applied within <code>mutate()</code>, for example <code>sum()</code> or <code>mean()</code> to
only name a few examples we already know.</p>
</div>
<div id="summarise-group_by" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> <code>summarise()</code> &amp; <code>group_by()</code></h2>
<p><code>summarise()</code> can be used to calculate summary statistics for a whole tibble.
The syntax is similar to <code>mutate()</code>. Let us compute the total number of persons
eligible to vote:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="dplyr.html#cb186-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb186-2"><a href="dplyr.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">eligible_total =</span> <span class="fu">sum</span>(eligible))</span>
<span id="cb186-3"><a href="dplyr.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 1</span></span>
<span id="cb186-4"><a href="dplyr.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   eligible_total</span></span>
<span id="cb186-5"><a href="dplyr.html#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="do">##            &lt;dbl&gt;</span></span>
<span id="cb186-6"><a href="dplyr.html#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1         400000</span></span></code></pre></div>
<p>As you can see, the result is a new tibble, containing only the summary
statistics we requested.</p>
<p>We also can compute multiple summary statistics in one step. Please note, that
the overall mean for turnout percentage can be computed as the mean of the
turnout percentages per group in this case only because all four groups are
exactly of the same size (<span class="math inline">\(n = 100000\)</span>). We will later look into computing the
same measure with our real data.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="dplyr.html#cb187-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb187-2"><a href="dplyr.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb187-3"><a href="dplyr.html#cb187-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">eligible_total =</span> <span class="fu">sum</span>(eligible),</span>
<span id="cb187-4"><a href="dplyr.html#cb187-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_total =</span> <span class="fu">sum</span>(turnout),</span>
<span id="cb187-5"><a href="dplyr.html#cb187-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_pct_mean =</span> <span class="fu">mean</span>(turnout_pct)</span>
<span id="cb187-6"><a href="dplyr.html#cb187-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb187-7"><a href="dplyr.html#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 3</span></span>
<span id="cb187-8"><a href="dplyr.html#cb187-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   eligible_total turnout_total turnout_pct_mean</span></span>
<span id="cb187-9"><a href="dplyr.html#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="do">##            &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb187-10"><a href="dplyr.html#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1         400000        330000            0.825</span></span></code></pre></div>
<p>Often we are interested in summaries grouped by the value of one or more other
variables. We might be interested in computing these summary statistics not for
the complete tibble but by gender. For this purpose, we can group the data by
the gender column using <code>group_by()</code> and then compute the summary statistics
separately for each group. As always with dplyr functions, <code>group_by()</code> needs
the data that shall be grouped as the first argument, followed by one or
multiple variables to group by.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="dplyr.html#cb188-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb188-2"><a href="dplyr.html#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender) <span class="sc">%&gt;%</span> </span>
<span id="cb188-3"><a href="dplyr.html#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb188-4"><a href="dplyr.html#cb188-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">eligible_total =</span> <span class="fu">sum</span>(eligible),</span>
<span id="cb188-5"><a href="dplyr.html#cb188-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_total =</span> <span class="fu">sum</span>(turnout),</span>
<span id="cb188-6"><a href="dplyr.html#cb188-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_pct_mean =</span> <span class="fu">mean</span>(turnout_pct)</span>
<span id="cb188-7"><a href="dplyr.html#cb188-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb188-8"><a href="dplyr.html#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 x 4</span></span>
<span id="cb188-9"><a href="dplyr.html#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   gender eligible_total turnout_total turnout_pct_mean</span></span>
<span id="cb188-10"><a href="dplyr.html#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="do">## * &lt;chr&gt;           &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb188-11"><a href="dplyr.html#cb188-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 m              200000        155000            0.775</span></span>
<span id="cb188-12"><a href="dplyr.html#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 w              200000        175000            0.875</span></span></code></pre></div>
<p>Let us create a final example, with two variables to group by. Let us assume
we have the turnout percentages by gender and age group for two elections. We
also again assume the same group size, i.e. the same “n”, for all observations.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="dplyr.html#cb189-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb189-2"><a href="dplyr.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">election =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb189-3"><a href="dplyr.html#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;w&quot;</span>, <span class="st">&quot;w&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;w&quot;</span>, <span class="st">&quot;w&quot;</span>),</span>
<span id="cb189-4"><a href="dplyr.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ybirth =</span> <span class="fu">c</span>(<span class="st">&quot;1993 - 1999&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>, <span class="st">&quot;1993 - 1999&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>, <span class="st">&quot;1993 - 1999&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>, <span class="st">&quot;1993 - 1999&quot;</span>, <span class="st">&quot;1983 - 1992&quot;</span>),</span>
<span id="cb189-5"><a href="dplyr.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">turnout_pct =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.55</span>, <span class="fl">0.75</span>, <span class="fl">0.625</span>, <span class="fl">0.7</span>, <span class="fl">0.65</span>, <span class="fl">0.85</span>, <span class="fl">0.725</span>)</span>
<span id="cb189-6"><a href="dplyr.html#cb189-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-7"><a href="dplyr.html#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="dplyr.html#cb189-8" aria-hidden="true" tabindex="-1"></a>exmpl_tbl_2</span>
<span id="cb189-9"><a href="dplyr.html#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 8 x 4</span></span>
<span id="cb189-10"><a href="dplyr.html#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   election gender ybirth      turnout_pct</span></span>
<span id="cb189-11"><a href="dplyr.html#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="do">##      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span id="cb189-12"><a href="dplyr.html#cb189-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1        1 m      1993 - 1999       0.6  </span></span>
<span id="cb189-13"><a href="dplyr.html#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2        1 m      1983 - 1992       0.55 </span></span>
<span id="cb189-14"><a href="dplyr.html#cb189-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 3        1 w      1993 - 1999       0.75 </span></span>
<span id="cb189-15"><a href="dplyr.html#cb189-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 4        1 w      1983 - 1992       0.625</span></span>
<span id="cb189-16"><a href="dplyr.html#cb189-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 5        2 m      1993 - 1999       0.7  </span></span>
<span id="cb189-17"><a href="dplyr.html#cb189-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 6        2 m      1983 - 1992       0.65 </span></span>
<span id="cb189-18"><a href="dplyr.html#cb189-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 7        2 w      1993 - 1999       0.85 </span></span>
<span id="cb189-19"><a href="dplyr.html#cb189-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 8        2 w      1983 - 1992       0.725</span></span></code></pre></div>
<p>To compute the mean turnout percentages by gender for each election separately,
we can group by election and gender.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="dplyr.html#cb190-1" aria-hidden="true" tabindex="-1"></a>exmpl_tbl_2 <span class="sc">%&gt;%</span> </span>
<span id="cb190-2"><a href="dplyr.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(election, gender) <span class="sc">%&gt;%</span> </span>
<span id="cb190-3"><a href="dplyr.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb190-4"><a href="dplyr.html#cb190-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnout_pct_mean =</span> <span class="fu">mean</span>(turnout_pct)</span>
<span id="cb190-5"><a href="dplyr.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb190-6"><a href="dplyr.html#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="do">## `summarise()` has grouped output by &#39;election&#39;. You can override using the `.groups` argument.</span></span>
<span id="cb190-7"><a href="dplyr.html#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 3</span></span>
<span id="cb190-8"><a href="dplyr.html#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   election [2]</span></span>
<span id="cb190-9"><a href="dplyr.html#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   election gender turnout_pct_mean</span></span>
<span id="cb190-10"><a href="dplyr.html#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="do">##      &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span id="cb190-11"><a href="dplyr.html#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1        1 m                 0.575</span></span>
<span id="cb190-12"><a href="dplyr.html#cb190-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2        1 w                 0.688</span></span>
<span id="cb190-13"><a href="dplyr.html#cb190-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 3        2 m                 0.675</span></span>
<span id="cb190-14"><a href="dplyr.html#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 4        2 w                 0.788</span></span></code></pre></div>
<p>There is a peculiarity to the way <code>group_by()</code> works with <code>summarise()</code> that can
cause headaches, if we are not aware of it. In general any <code>summarise()</code>
function following a <code>group_by()</code> will calculate the summary statistic and then
remove one level of grouping. In the examples where we only had one level of
grouping, this essentially meant, that the data was ungrouped after
<code>summarise()</code>. In the last example we had two levels of grouping. So after the
computation of the mean turnout percentage by <code>election</code> and <code>gender</code>, the
grouping by <code>gender</code> was removed, but the grouping by <code>election</code> remained in
effect. We can see this in the output, where R informs us about the column by
which the data is grouped and the number of groups in the output:
<code>## # Groups:   election [2]</code>. Another <code>summarise()</code> function would compute the
statistic by <code>election</code> and then remove this level also. We can also use
<code>ungroup()</code> to remove all grouping from a tibble. In the case of this example,
this does not make a practical difference as we only compute the summary and
move on. If we assign the results of a summary to an object for later use in
data analysis, we have to think about removing groups though.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="good-practice.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/webscraping-tures/webscraping-tures.github.io/10-dplyr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

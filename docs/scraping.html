<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Running example | Web Scraping using R</title>
  <meta name="description" content="10 Running example | Web Scraping using R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Running example | Web Scraping using R" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="webscraping-tures/webscraping-tures.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Running example | Web Scraping using R" />
  
  
  

<meta name="author" content="Jakob Tures" />


<meta name="date" content="2021-06-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="good-practice.html"/>
<link rel="next" href="dplyr.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/echarts4r-4.8.0/echarts-en.min.js"></script>
<script src="libs/echarts4r-4.8.0/ecStat.min.js"></script>
<script src="libs/echarts4r-4.8.0/dataTool.min.js"></script>
<script src="libs/echarts4r-binding-0.4.0/echarts4r.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
Web Scraping using R

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-web-scraping"><i class="fa fa-check"></i>What is web scraping?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-contents"><i class="fa fa-check"></i>Course contents</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#technical-requirements"><i class="fa fa-check"></i>Technical requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="1" data-path="html.html"><a href="html.html"><i class="fa fa-check"></i><b>1</b> HTML as a cornerstone of the internet</a>
<ul>
<li class="chapter" data-level="1.1" data-path="html.html"><a href="html.html#html-tags"><i class="fa fa-check"></i><b>1.1</b> HTML-Tags</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="html.html"><a href="html.html#hello_world.html"><i class="fa fa-check"></i><b>1.1.1</b> hello_world.html</a></li>
<li class="chapter" data-level="1.1.2" data-path="html.html"><a href="html.html#important-tags"><i class="fa fa-check"></i><b>1.1.2</b> Important tags</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="html.html"><a href="html.html#attribute"><i class="fa fa-check"></i><b>1.2</b> Attributes</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="html.html"><a href="html.html#links"><i class="fa fa-check"></i><b>1.2.1</b> Links</a></li>
<li class="chapter" data-level="1.2.2" data-path="html.html"><a href="html.html#images"><i class="fa fa-check"></i><b>1.2.2</b> Images</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="html.html"><a href="html.html#entities"><i class="fa fa-check"></i><b>1.3</b> Entities</a></li>
</ul></li>
<li class="part"><span><b>II R Basics &amp; Tidyverse</b></span></li>
<li class="chapter" data-level="2" data-path="R1.html"><a href="R1.html"><i class="fa fa-check"></i><b>2</b> R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="R1.html"><a href="R1.html#installing-r"><i class="fa fa-check"></i><b>2.1</b> Installing R</a></li>
<li class="chapter" data-level="2.2" data-path="R1.html"><a href="R1.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="R1.html"><a href="R1.html#overview"><i class="fa fa-check"></i><b>2.2.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="R1.html"><a href="R1.html#hello-world"><i class="fa fa-check"></i><b>2.3</b> Hello World!</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="R1.html"><a href="R1.html#calculating-with-r"><i class="fa fa-check"></i><b>2.3.1</b> Calculating with R</a></li>
<li class="chapter" data-level="2.3.2" data-path="R1.html"><a href="R1.html#comparison"><i class="fa fa-check"></i><b>2.3.2</b> Comparison operators</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="R1.html"><a href="R1.html#objects"><i class="fa fa-check"></i><b>2.4</b> Objects</a></li>
<li class="chapter" data-level="2.5" data-path="R1.html"><a href="R1.html#vectors"><i class="fa fa-check"></i><b>2.5</b> Vectors</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="R1.html"><a href="R1.html#subsetting"><i class="fa fa-check"></i><b>2.5.1</b> Subsetting</a></li>
<li class="chapter" data-level="2.5.2" data-path="R1.html"><a href="R1.html#types-of-vectors"><i class="fa fa-check"></i><b>2.5.2</b> Types of vectors</a></li>
<li class="chapter" data-level="2.5.3" data-path="R1.html"><a href="R1.html#a-brief-look-at-lists"><i class="fa fa-check"></i><b>2.5.3</b> A brief look at lists</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="R1.html"><a href="R1.html#functions"><i class="fa fa-check"></i><b>2.6</b> Functions</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="R1.html"><a href="R1.html#help"><i class="fa fa-check"></i><b>2.6.1</b> Help</a></li>
<li class="chapter" data-level="2.6.2" data-path="R1.html"><a href="R1.html#examples-basic-statistical-functions"><i class="fa fa-check"></i><b>2.6.2</b> Examples: Basic statistical functions</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="R1.html"><a href="R1.html#ifelse-statements"><i class="fa fa-check"></i><b>2.7</b> If/Else statements</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="R2.html"><a href="R2.html"><i class="fa fa-check"></i><b>3</b> RStudio in practice &amp; the tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="R2.html"><a href="R2.html#rstudio-workflow"><i class="fa fa-check"></i><b>3.1</b> RStudio Workflow</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="R2.html"><a href="R2.html#r-scripts"><i class="fa fa-check"></i><b>3.1.1</b> R Scripts</a></li>
<li class="chapter" data-level="3.1.2" data-path="R2.html"><a href="R2.html#projects"><i class="fa fa-check"></i><b>3.1.2</b> Projects</a></li>
<li class="chapter" data-level="3.1.3" data-path="R2.html"><a href="R2.html#comments"><i class="fa fa-check"></i><b>3.1.3</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="R2.html"><a href="R2.html#r-packages"><i class="fa fa-check"></i><b>3.2</b> R packages</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="R2.html"><a href="R2.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>3.2.1</b> Installing and loading packages</a></li>
<li class="chapter" data-level="3.2.2" data-path="R2.html"><a href="R2.html#namespaces"><i class="fa fa-check"></i><b>3.2.2</b> Namespaces</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="R2.html"><a href="R2.html#tidyverse"><i class="fa fa-check"></i><b>3.3</b> Tidyverse</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="R2.html"><a href="R2.html#tibbles"><i class="fa fa-check"></i><b>3.3.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="R2.html"><a href="R2.html#additional-resources"><i class="fa fa-check"></i><b>3.4</b> Additional resources</a></li>
</ul></li>
<li class="part"><span><b>III Scraping</b></span></li>
<li class="chapter" data-level="4" data-path="rvest1.html"><a href="rvest1.html"><i class="fa fa-check"></i><b>4</b> First scraping with rvest</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rvest1.html"><a href="rvest1.html#the-rvest-package"><i class="fa fa-check"></i><b>4.1</b> The rvest package</a></li>
<li class="chapter" data-level="4.2" data-path="rvest1.html"><a href="rvest1.html#hello_world.html-1"><i class="fa fa-check"></i><b>4.2</b> hello_world.html</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rvest1.html"><a href="rvest1.html#read_html"><i class="fa fa-check"></i><b>4.2.1</b> read_html()</a></li>
<li class="chapter" data-level="4.2.2" data-path="rvest1.html"><a href="rvest1.html#html_nodes"><i class="fa fa-check"></i><b>4.2.2</b> html_nodes()</a></li>
<li class="chapter" data-level="4.2.3" data-path="rvest1.html"><a href="rvest1.html#html_text"><i class="fa fa-check"></i><b>4.2.3</b> html_text()</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rvest1.html"><a href="rvest1.html#countries-of-the-world"><i class="fa fa-check"></i><b>4.3</b> Countries of the World</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rvest1.html"><a href="rvest1.html#country-names"><i class="fa fa-check"></i><b>4.3.1</b> Country names</a></li>
<li class="chapter" data-level="4.3.2" data-path="rvest1.html"><a href="rvest1.html#capitals-population-and-area"><i class="fa fa-check"></i><b>4.3.2</b> Capitals, population and area</a></li>
<li class="chapter" data-level="4.3.3" data-path="rvest1.html"><a href="rvest1.html#merge-into-one-tibble"><i class="fa fa-check"></i><b>4.3.3</b> Merge into one tibble</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html"><i class="fa fa-check"></i><b>5</b> CSS selectors &amp; Developer Tools</a>
<ul>
<li class="chapter" data-level="5.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#css"><i class="fa fa-check"></i><b>5.1</b> CSS selectors</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#classes"><i class="fa fa-check"></i><b>5.1.1</b> Classes</a></li>
<li class="chapter" data-level="5.1.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#ids"><i class="fa fa-check"></i><b>5.1.2</b> IDs</a></li>
<li class="chapter" data-level="5.1.3" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#attributes"><i class="fa fa-check"></i><b>5.1.3</b> Attributes</a></li>
<li class="chapter" data-level="5.1.4" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#hierarchy-levels"><i class="fa fa-check"></i><b>5.1.4</b> Hierarchy levels</a></li>
<li class="chapter" data-level="5.1.5" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#further-selectors"><i class="fa fa-check"></i><b>5.1.5</b> Further selectors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="css-selectors-developer-tools.html"><a href="css-selectors-developer-tools.html#developer-tools"><i class="fa fa-check"></i><b>5.2</b> Developer Tools</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rvest2.html"><a href="rvest2.html"><i class="fa fa-check"></i><b>6</b> Scraping of tables &amp; dynamic websites</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rvest2.html"><a href="rvest2.html#scraping-of-tables"><i class="fa fa-check"></i><b>6.1</b> Scraping of tables</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rvest2.html"><a href="rvest2.html#table-with-css-selectors-from-wikipedia"><i class="fa fa-check"></i><b>6.1.1</b> Table with CSS selectors from Wikipedia</a></li>
<li class="chapter" data-level="6.1.2" data-path="rvest2.html"><a href="rvest2.html#scraping-multiple-tables"><i class="fa fa-check"></i><b>6.1.2</b> Scraping multiple tables</a></li>
<li class="chapter" data-level="6.1.3" data-path="rvest2.html"><a href="rvest2.html#tabellen-mit-nas"><i class="fa fa-check"></i><b>6.1.3</b> Tabellen mit NAs</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rvest2.html"><a href="rvest2.html#dynamische-websites"><i class="fa fa-check"></i><b>6.2</b> Dynamische Websites</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rvest2.html"><a href="rvest2.html#html-forms-and-html-queries"><i class="fa fa-check"></i><b>6.2.1</b> HTML forms and HTML queries</a></li>
<li class="chapter" data-level="6.2.2" data-path="rvest2.html"><a href="rvest2.html#html-forms"><i class="fa fa-check"></i><b>6.2.2</b> HTML forms</a></li>
<li class="chapter" data-level="6.2.3" data-path="rvest2.html"><a href="rvest2.html#the-query"><i class="fa fa-check"></i><b>6.2.3</b> The query</a></li>
<li class="chapter" data-level="6.2.4" data-path="rvest2.html"><a href="rvest2.html#manipulating-the-query-and-scraping-the-result"><i class="fa fa-check"></i><b>6.2.4</b> Manipulating the query and scraping the result</a></li>
<li class="chapter" data-level="6.2.5" data-path="rvest2.html"><a href="rvest2.html#additional-resources-1"><i class="fa fa-check"></i><b>6.2.5</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rvest3.html"><a href="rvest3.html"><i class="fa fa-check"></i><b>7</b> Scraping of multi-page websites</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rvest3.html"><a href="rvest3.html#index-pages"><i class="fa fa-check"></i><b>7.1</b> Index-pages</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rvest3.html"><a href="rvest3.html#scraping-of-the-index"><i class="fa fa-check"></i><b>7.1.1</b> Scraping of the index</a></li>
<li class="chapter" data-level="7.1.2" data-path="rvest3.html"><a href="rvest3.html#iteration-with-map"><i class="fa fa-check"></i><b>7.1.2</b> Iteration with map()</a></li>
<li class="chapter" data-level="7.1.3" data-path="rvest3.html"><a href="rvest3.html#scraping-the-sub-pages"><i class="fa fa-check"></i><b>7.1.3</b> Scraping the sub-pages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rvest3.html"><a href="rvest3.html#pagination"><i class="fa fa-check"></i><b>7.2</b> Pagination</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rvest3.html"><a href="rvest3.html#the-query-1"><i class="fa fa-check"></i><b>7.2.1</b> The query</a></li>
<li class="chapter" data-level="7.2.2" data-path="rvest3.html"><a href="rvest3.html#sub-pgs"><i class="fa fa-check"></i><b>7.2.2</b> Scraping the sub-pages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="files.html"><a href="files.html"><i class="fa fa-check"></i><b>8</b> Downloading and saving files</a>
<ul>
<li class="chapter" data-level="8.1" data-path="files.html"><a href="files.html#csv-files"><i class="fa fa-check"></i><b>8.1</b> CSV files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="files.html"><a href="files.html#parsing-a-csv-file"><i class="fa fa-check"></i><b>8.1.1</b> Parsing a CSV file</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="files.html"><a href="files.html#downloading-files"><i class="fa fa-check"></i><b>8.2</b> Downloading files</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="files.html"><a href="files.html#parsing-the-csv-files"><i class="fa fa-check"></i><b>8.2.1</b> Parsing the csv files</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="files.html"><a href="files.html#saving-data-files"><i class="fa fa-check"></i><b>8.3</b> Saving data files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="good-practice.html"><a href="good-practice.html"><i class="fa fa-check"></i><b>9</b> Good practice</a>
<ul>
<li class="chapter" data-level="9.1" data-path="good-practice.html"><a href="good-practice.html#we-aint-no-web-crawlers"><i class="fa fa-check"></i><b>9.1</b> We ain’t no web crawlers</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="good-practice.html"><a href="good-practice.html#on-robots.txt-files"><i class="fa fa-check"></i><b>9.1.1</b> On robots.txt files</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="good-practice.html"><a href="good-practice.html#reduce-traffic"><i class="fa fa-check"></i><b>9.2</b> Reduce traffic</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="good-practice.html"><a href="good-practice.html#waiting-times-in-action"><i class="fa fa-check"></i><b>9.2.1</b> Waiting times in action</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="good-practice.html"><a href="good-practice.html#citation-and-an-additional-resource"><i class="fa fa-check"></i><b>9.3</b> Citation and an additional resource</a></li>
</ul></li>
<li class="part"><span><b>IV Data analysis</b></span></li>
<li class="chapter" data-level="10" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>10</b> Running example</a>
<ul>
<li class="chapter" data-level="10.1" data-path="scraping.html"><a href="scraping.html#gathering-the-links"><i class="fa fa-check"></i><b>10.1</b> Gathering the links</a></li>
<li class="chapter" data-level="10.2" data-path="scraping.html"><a href="scraping.html#downloading-the-subpages"><i class="fa fa-check"></i><b>10.2</b> Downloading the subpages</a></li>
<li class="chapter" data-level="10.3" data-path="scraping.html"><a href="scraping.html#extracting-the-data-of-interest"><i class="fa fa-check"></i><b>10.3</b> Extracting the data of interest</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="scraping.html"><a href="scraping.html#dealing-with-missing-data-in-lists"><i class="fa fa-check"></i><b>10.3.1</b> Dealing with missing data in lists</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="scraping.html"><a href="scraping.html#saving-the-data"><i class="fa fa-check"></i><b>10.4</b> Saving the data</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>11</b> Transformation with dplyr</a>
<ul>
<li class="chapter" data-level="11.1" data-path="dplyr.html"><a href="dplyr.html#mutate"><i class="fa fa-check"></i><b>11.1</b> <code>mutate()</code></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="dplyr.html"><a href="dplyr.html#computing-new-variables-from-existing-ones"><i class="fa fa-check"></i><b>11.1.1</b> Computing new variables from existing ones</a></li>
<li class="chapter" data-level="11.1.2" data-path="dplyr.html"><a href="dplyr.html#cleaning-the-running-example"><i class="fa fa-check"></i><b>11.1.2</b> Cleaning the running example</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="dplyr.html"><a href="dplyr.html#select"><i class="fa fa-check"></i><b>11.2</b> <code>select()</code></a></li>
<li class="chapter" data-level="11.3" data-path="dplyr.html"><a href="dplyr.html#rename"><i class="fa fa-check"></i><b>11.3</b> <code>rename()</code></a></li>
<li class="chapter" data-level="11.4" data-path="dplyr.html"><a href="dplyr.html#filter"><i class="fa fa-check"></i><b>11.4</b> <code>filter()</code></a></li>
<li class="chapter" data-level="11.5" data-path="dplyr.html"><a href="dplyr.html#summarise-group_by"><i class="fa fa-check"></i><b>11.5</b> <code>summarise()</code> &amp; <code>group_by()</code></a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="dplyr.html"><a href="dplyr.html#number-of-reports-by-groups"><i class="fa fa-check"></i><b>11.5.1</b> Number of reports by groups</a></li>
<li class="chapter" data-level="11.5.2" data-path="dplyr.html"><a href="dplyr.html#summary-statistics-on-the-time"><i class="fa fa-check"></i><b>11.5.2</b> Summary statistics on the time</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot.html"><a href="ggplot.html"><i class="fa fa-check"></i><b>12</b> Graphical analysis with ggplot</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ggplot.html"><a href="ggplot.html#ggplot-syntax"><i class="fa fa-check"></i><b>12.1</b> ggplot syntax</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot.html"><a href="ggplot.html#aesthetics"><i class="fa fa-check"></i><b>12.2</b> Aesthetics</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ggplot.html"><a href="ggplot.html#continuous"><i class="fa fa-check"></i><b>12.2.1</b> Continuous</a></li>
<li class="chapter" data-level="12.2.2" data-path="ggplot.html"><a href="ggplot.html#continuous-x-continuous"><i class="fa fa-check"></i><b>12.2.2</b> Continuous x Continuous</a></li>
<li class="chapter" data-level="12.2.3" data-path="ggplot.html"><a href="ggplot.html#discrete-x-continuous"><i class="fa fa-check"></i><b>12.2.3</b> Discrete x Continuous</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="ggplot.html"><a href="ggplot.html#tuning-the-output"><i class="fa fa-check"></i><b>12.3</b> Tuning the output</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="regex.html"><a href="regex.html"><i class="fa fa-check"></i><b>13</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="13.1" data-path="regex.html"><a href="regex.html#str_detect"><i class="fa fa-check"></i><b>13.1</b> str_detect()</a></li>
<li class="chapter" data-level="13.2" data-path="regex.html"><a href="regex.html#basic-pattern-matching"><i class="fa fa-check"></i><b>13.2</b> Basic pattern matching</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="regex.html"><a href="regex.html#literal-characters"><i class="fa fa-check"></i><b>13.2.1</b> Literal characters</a></li>
<li class="chapter" data-level="13.2.2" data-path="regex.html"><a href="regex.html#escaping-metacharacters"><i class="fa fa-check"></i><b>13.2.2</b> Escaping metacharacters</a></li>
<li class="chapter" data-level="13.2.3" data-path="regex.html"><a href="regex.html#character-classes"><i class="fa fa-check"></i><b>13.2.3</b> Character classes</a></li>
<li class="chapter" data-level="13.2.4" data-path="regex.html"><a href="regex.html#anchors"><i class="fa fa-check"></i><b>13.2.4</b> Anchors</a></li>
<li class="chapter" data-level="13.2.5" data-path="regex.html"><a href="regex.html#quantifiers"><i class="fa fa-check"></i><b>13.2.5</b> Quantifiers</a></li>
<li class="chapter" data-level="13.2.6" data-path="regex.html"><a href="regex.html#groups"><i class="fa fa-check"></i><b>13.2.6</b> Groups</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="regex.html"><a href="regex.html#practical-application"><i class="fa fa-check"></i><b>13.3</b> Practical application</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="regex.html"><a href="regex.html#str_count"><i class="fa fa-check"></i><b>13.3.1</b> str_count()</a></li>
<li class="chapter" data-level="13.3.2" data-path="regex.html"><a href="regex.html#str_extract-str_match"><i class="fa fa-check"></i><b>13.3.2</b> str_extract() &amp; str_match()</a></li>
<li class="chapter" data-level="13.3.3" data-path="regex.html"><a href="regex.html#str_replace"><i class="fa fa-check"></i><b>13.3.3</b> str_replace()</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Web Scraping using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scraping" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Running example</h1>
<p>This last part of the website will introduce the basics of data analysis and of
using regular expressions when dealing with textual data. Before we begin, this
chapter will show and briefly explain the scraping of the data we will use as a
running example throughout the remaining chapters.</p>
<p>The website
<a href="https://www.berlin.de/polizei/polizeimeldungen/archiv/" target="_blank">https://www.berlin.de/polizei/polizeimeldungen/archiv/</a>
contains publicly released reports by the Berlin police, beginning with the year
2014. The goal for this chapter will be to gather the links to all subpages,
download them and extract the text of the report as well as the date, time and
district where it occurred.</p>
<div id="gathering-the-links" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Gathering the links</h2>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="scraping.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb176-2"><a href="scraping.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code></pre></div>
<p>We begin with downloading the mainpage.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="scraping.html#cb177-1" aria-hidden="true" tabindex="-1"></a>website <span class="ot">&lt;-</span> <span class="st">&quot;https://www.berlin.de/polizei/polizeimeldungen/archiv/&quot;</span> <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="scraping.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_html</span>()</span></code></pre></div>
<p>The next step is to extract the URLs for the yearly archives. All the <code>&lt;a&gt;</code> tags
that contain those links, have a <code>title=</code> attribute whose value begins with
“Link”. We can use this in selector construction, extract the value of the
<code>href=</code> attribute and, as they are incomplete URLs, append them to the base URL.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="scraping.html#cb178-1" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> website <span class="sc">%&gt;%</span> </span>
<span id="cb178-2"><a href="scraping.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="at">css =</span> <span class="st">&quot;div.html5-section.body a[title^=&#39;Link&#39;]&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb178-3"><a href="scraping.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="at">name =</span> <span class="st">&quot;href&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb178-4"><a href="scraping.html#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="st">&quot;https://www.berlin.de&quot;</span>, .)</span></code></pre></div>
<p>Each yearly archive page contains several subpages for the reports in that year,
divided by pagination. So to gather the links to all subpages, we have to
understand how the pagination works in this case. Here the URL for the yearly
archive is simply appended with the query “?page_at_1_0=” and a value indicating
the number of the subpage we want to access.
So “<a href="https://www.berlin.de/polizei/polizeimeldungen/archiv/2020/?page_at_1_0=5" class="uri">https://www.berlin.de/polizei/polizeimeldungen/archiv/2020/?page_at_1_0=5</a>”
for example gives access to the fifth page for 2020.</p>
<p>As the number of police reports is not constant over the years, the number of
subpages per year will also differ. So, we do not know in advance, how many
subpages we will have to download. But we can scrape this information from the
last pagination link for each year. We read the first page for each year, select
the <code>&lt;a&gt;</code> tag for the last subpage, extract the text from it and save it as a
number. Note that I also added a waiting time of two seconds between each
download, as shown in chapter @ref(good_practice).</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="scraping.html#cb179-1" aria-hidden="true" tabindex="-1"></a>max_pages <span class="ot">&lt;-</span> links <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="scraping.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> {</span>
<span id="cb179-3"><a href="scraping.html#cb179-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb179-4"><a href="scraping.html#cb179-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_html</span>(.x)</span>
<span id="cb179-5"><a href="scraping.html#cb179-5" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb179-6"><a href="scraping.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(html_node, <span class="at">css =</span> <span class="st">&quot;li.pager-item.last &gt; a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb179-7"><a href="scraping.html#cb179-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb179-8"><a href="scraping.html#cb179-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span></code></pre></div>
<p>Now we can construct the links to all subpages; in my script by nesting two for
loops.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="scraping.html#cb180-1" aria-hidden="true" tabindex="-1"></a>pag_links <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb180-2"><a href="scraping.html#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="scraping.html#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(links)) {</span>
<span id="cb180-4"><a href="scraping.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_pages[i]) {</span>
<span id="cb180-5"><a href="scraping.html#cb180-5" aria-hidden="true" tabindex="-1"></a>    pag_links <span class="ot">&lt;-</span> <span class="fu">append</span>(pag_links, <span class="at">values =</span> <span class="fu">str_c</span>(links[i], <span class="st">&quot;?page_at_1_0=&quot;</span>, j))</span>
<span id="cb180-6"><a href="scraping.html#cb180-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb180-7"><a href="scraping.html#cb180-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The outer loop is a counter for the elements in the objects <code>links</code>. So
in this case the loop counts from 1 to 8, one step for each yearly archive page.
For each of these iterations, the inner loop will count from 1 to the number of
the last subpage for this year, which we assigned to the vector <code>max_pages</code>.
Using both counters together, we can construct the links to the subpages using
<code>str_c()</code>. The function takes the link to a yearly archive indicated by the
counter in the outer loop <code>i</code>, appends “?page_at_1_0=” and after this the value
of the inner loop counter <code>j</code>. The resulting link is then added to the vector
<code>pag_links</code> using the function <code>append()</code> which adds the data indicated by the
argument <code>values</code> to the object specified in the first argument. For this to
work, we first have to initialise the object as an empty object outside of the
loop first. Here I created it as an empty character vector, using
<code>pag_links &lt;- character()</code>. If you want to create an empty object without any
data type assigned, you can also use <code>empty_vector &lt;- NULL</code></p>
</div>
<div id="downloading-the-subpages" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Downloading the subpages</h2>
<p>Now that the the links to all subpages are gathered, we can finally download
them. Please note, that the download will take up to 20 minutes due to the
number of subpages (337 at the time of writing) and the waiting time of 2
seconds between each iteration.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="scraping.html#cb181-1" aria-hidden="true" tabindex="-1"></a>pages <span class="ot">&lt;-</span> pag_links <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="scraping.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> {</span>
<span id="cb181-3"><a href="scraping.html#cb181-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb181-4"><a href="scraping.html#cb181-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_html</span>(.x)</span>
<span id="cb181-5"><a href="scraping.html#cb181-5" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
</div>
<div id="extracting-the-data-of-interest" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Extracting the data of interest</h2>
<p>Our goal is to extract the text of the report, the date/time and the district
the report refers to. Let us try to appraoch this, using the techniques we
developed over the last chapters:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="scraping.html#cb182-1" aria-hidden="true" tabindex="-1"></a>reports <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb182-2"><a href="scraping.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> pages <span class="sc">%&gt;%</span> </span>
<span id="cb182-3"><a href="scraping.html#cb182-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(html_nodes, <span class="at">css =</span> <span class="st">&quot;div.cell.date&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb182-4"><a href="scraping.html#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb182-5"><a href="scraping.html#cb182-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>(),</span>
<span id="cb182-6"><a href="scraping.html#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Report =</span> pages <span class="sc">%&gt;%</span> </span>
<span id="cb182-7"><a href="scraping.html#cb182-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(html_nodes, <span class="at">css =</span> <span class="st">&quot;div.cell.text &gt; a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb182-8"><a href="scraping.html#cb182-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb182-9"><a href="scraping.html#cb182-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>(),</span>
<span id="cb182-10"><a href="scraping.html#cb182-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">District =</span> pages <span class="sc">%&gt;%</span> </span>
<span id="cb182-11"><a href="scraping.html#cb182-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(html_nodes, <span class="at">css =</span> <span class="st">&quot;span.category&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb182-12"><a href="scraping.html#cb182-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(html_text) <span class="sc">%&gt;%</span> </span>
<span id="cb182-13"><a href="scraping.html#cb182-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>()</span>
<span id="cb182-14"><a href="scraping.html#cb182-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb182-15"><a href="scraping.html#cb182-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Error: Tibble columns must have compatible sizes.</span></span>
<span id="cb182-16"><a href="scraping.html#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="do">## * Size 16698: Existing data.</span></span>
<span id="cb182-17"><a href="scraping.html#cb182-17" aria-hidden="true" tabindex="-1"></a><span class="do">## * Size 16303: Column `District`.</span></span>
<span id="cb182-18"><a href="scraping.html#cb182-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Only values of size one are recycled.</span></span></code></pre></div>
<p>That did not work. But why? Let us look at the error message we received.
It informs us, that the column “District” we tried to create is shorter in
length compared to the other two. As we can not create tibbles out of columns with
different lengths, the error is thrown.</p>
<p>The fact that the “District” column is shorter than the other two, must mean
that there are police reports where the information on the district is not
listed on the website. We can confirm this by browsing some of the subpages,
e.g. <a href="https://www.berlin.de/polizei/polizeimeldungen/archiv/2014/" target="_blank">https://www.berlin.de/polizei/polizeimeldungen/archiv/2014/</a>.</p>
<div id="dealing-with-missing-data-in-lists" class="section level3" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Dealing with missing data in lists</h3>
<p>Some of the <code>&lt;span&gt;</code> tags that contain the district are missing. Using the
approach presented above, <code>html_nodes()</code> just extracts the <code>&lt;span&gt;</code> tags that
are present. We tell R that we do want all <code>&lt;span&gt;</code> tags of the class
“category”, and this is what R returns to us. The cases where the tag is missing
are skipped. But this is not what we want. What we actually want is, that R
looks at every single police report and saves its text, date and time as well as
the district, if it is not missing. If it is missing, we want R to save a <code>NA</code>
in the cell of the tibble, the representation of missing values in R.</p>
<p>The <code>&lt;div&gt;</code> and <code>&lt;span&gt;</code> tags that contain the data of interest are nested in
<code>&lt;li&gt;</code> tags in this case. The <code>&lt;li&gt;</code> tags thus contain the whole set of data,
the text, the date/time and the district. The approach here is to make R examine
every single <code>&lt;li&gt;</code> tag and extract the data that is present as well as save an
<code>NA</code> for every piece of data that is missing.</p>
<p>So, first we have to extract all the <code>&lt;li&gt;</code> tags and their content from the
subpages. Right now, the subpages are saved in the object <code>pages</code>. We use a for
loop that takes every element of <code>pages</code> extracts all the <code>&lt;li&gt;</code> tags from it
and adds them to a new list using <code>append()</code>. <code>append()</code> takes an existing
object as its first argument and adds the data indicated in the <code>values =</code>
argument to it. For this to work, we have to initiate the new list as an empty
object, before the loop starts.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="scraping.html#cb183-1" aria-hidden="true" tabindex="-1"></a>list_items <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb183-2"><a href="scraping.html#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="scraping.html#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pages)) {</span>
<span id="cb183-4"><a href="scraping.html#cb183-4" aria-hidden="true" tabindex="-1"></a>  list_items <span class="ot">&lt;-</span> <span class="fu">append</span>(list_items, <span class="at">values =</span> <span class="fu">html_nodes</span>(pages[[i]], <span class="at">css =</span> <span class="st">&quot;li.row-fluid&quot;</span>))</span>
<span id="cb183-5"><a href="scraping.html#cb183-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The newly created list <code>list_items</code> contains a nodeset for each <code>&lt;li&gt;</code> tag from
all subpages:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="scraping.html#cb184-1" aria-hidden="true" tabindex="-1"></a>list_items[[<span class="dv">1</span>]]</span>
<span id="cb184-2"><a href="scraping.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="do">## {html_node}</span></span>
<span id="cb184-3"><a href="scraping.html#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;li class=&quot;row-fluid&quot;&gt;</span></span>
<span id="cb184-4"><a href="scraping.html#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &lt;div class=&quot;span2 cell date&quot;&gt;21.06.2021 15:17 Uhr&lt;/div&gt;\n</span></span>
<span id="cb184-5"><a href="scraping.html#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] &lt;div class=&quot;span10 cell text&quot;&gt;\n&lt;a href=&quot;/polizei/polizeimeldungen/2021/p ...</span></span></code></pre></div>
<p>We can now make R examine every element of this list and extract all the data it
contains. But what happens when we try to extract a node that is not present in
one of the elements? R returns an <code>NA</code>:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="scraping.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">html_node</span>(list_items[[<span class="dv">1</span>]], <span class="at">css =</span> <span class="st">&quot;span.notthere&quot;</span>)</span>
<span id="cb185-2"><a href="scraping.html#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="do">## {xml_missing}</span></span>
<span id="cb185-3"><a href="scraping.html#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;NA&gt;</span></span></code></pre></div>
<p>Using a for loop that iterates over the elements in <code>list_items</code> we write a
tibble row by row; filling the data cells with the extracted information and
with <code>NA</code> if a node could not be found for this element of <code>list_items</code>. We have
to initiate the tibble before the for loop starts. So we define the columns
names, the type of data to be saved and also the length of the columns. The
latter is not strictly necessary as we could also have created a tibble with a
column length of <span class="math inline">\(0\)</span>, but pre-defining their length increases computational
efficiency. Still, the for loop has to iterate over several thousand elements
and extract the data contained, which will take several minutes to complete.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="scraping.html#cb186-1" aria-hidden="true" tabindex="-1"></a>reports <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb186-2"><a href="scraping.html#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">character</span>()[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)],</span>
<span id="cb186-3"><a href="scraping.html#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Report =</span> <span class="fu">character</span>()[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)],</span>
<span id="cb186-4"><a href="scraping.html#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">District =</span> <span class="fu">character</span>()[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)]</span>
<span id="cb186-5"><a href="scraping.html#cb186-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb186-6"><a href="scraping.html#cb186-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-7"><a href="scraping.html#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_items)) {</span>
<span id="cb186-8"><a href="scraping.html#cb186-8" aria-hidden="true" tabindex="-1"></a>  reports[i, <span class="st">&quot;Date&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">html_node</span>(list_items[[i]], <span class="at">css =</span> <span class="st">&quot;div.cell.date&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-9"><a href="scraping.html#cb186-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text</span>()</span>
<span id="cb186-10"><a href="scraping.html#cb186-10" aria-hidden="true" tabindex="-1"></a>  reports[i, <span class="st">&quot;Report&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">html_node</span>(list_items[[i]], <span class="at">css =</span> <span class="st">&quot;div.cell.text &gt; a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-11"><a href="scraping.html#cb186-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text</span>()</span>
<span id="cb186-12"><a href="scraping.html#cb186-12" aria-hidden="true" tabindex="-1"></a>  reports[i, <span class="st">&quot;District&quot;</span>] <span class="ot">&lt;-</span> <span class="fu">html_node</span>(list_items[[i]], <span class="at">css =</span> <span class="st">&quot;span.category&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-13"><a href="scraping.html#cb186-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text</span>()</span>
<span id="cb186-14"><a href="scraping.html#cb186-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="saving-the-data" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Saving the data</h2>
<p>As discussed in chapter <a href="files.html#files">8</a>, at this point we should maybe save the
scraped data. As you have seen, we downloaded a lot of subpages which took a
considerable amount of time. If we repeat this for every instance of further
data analysis, we create a lot of unnecessary traffic and waste a lot of our own
time.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="scraping.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(reports, <span class="at">file =</span> <span class="st">&quot;reports.RData&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="good-practice.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dplyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/webscraping-tures/webscraping-tures.github.io/10-rvest4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
